# WeKnora ç»„ç»‡æ ‘ä¸çŸ¥è¯†åº“å¯è§æ€§æ‰©å±•æ–¹æ¡ˆ

> **æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
> **åˆ›å»ºæ—¥æœŸ**: 2026-02-10  
> **é€‚ç”¨é¡¹ç›®**: WeKnora çŸ¥è¯†åº“ç®¡ç†å¹³å°  
> **æ–‡æ¡£æ€§è´¨**: æ‰©å±•è®¾è®¡æ–¹æ¡ˆï¼ˆåŸºäºç°æœ‰ Organization æ¨¡å‹æ¼”è¿›ï¼‰

---

## 1. éœ€æ±‚æ¦‚è¿°

| åºå· | éœ€æ±‚ | è¯´æ˜ |
|------|------|------|
| 1 | **RBAC æƒé™æ§åˆ¶** | æ˜¯å¦éœ€è¦å¼•å…¥è§’è‰² + æƒé™ï¼ˆRBACï¼‰ä½“ç³»ï¼Œè¿˜æ˜¯æ²¿ç”¨ç°æœ‰ã€Œè¶…ç®¡ + ç»„ç»‡è§’è‰²ã€åˆ†å±‚æ¨¡å‹ |
| 2 | **è¶…çº§ç®¡ç†å‘˜ä¸“ç”¨é¡µé¢** | ç³»ç»Ÿè®¾ç½®ä¸­çš„æ¨¡å‹é…ç½®ã€Ollamaã€ç½‘ç»œæœç´¢ã€MCP æœåŠ¡ã€ç³»ç»Ÿä¿¡æ¯ã€ç§Ÿæˆ·ä¿¡æ¯ç­‰é¡µé¢ï¼Œä»…è¶…ç®¡å¯ç»´æŠ¤ |
| 3 | **ç”¨æˆ·å±äºç»„ç»‡** | æ¯ä¸ªç”¨æˆ·è‡³å°‘å±äºä¸€ä¸ªç»„ç»‡ï¼Œåªèƒ½çœ‹åˆ°å½“å‰ç»„ç»‡çš„çŸ¥è¯†åº“å’Œä¸ªäººçŸ¥è¯†åº“ |
| 4 | **å¤šç»„ç»‡å½’å±** | ä¸€ä¸ªç”¨æˆ·å¯ä»¥åŒæ—¶å­˜åœ¨äºå¤šä¸ªç»„ç»‡ä¸­ï¼Œéœ€è¦ã€Œåˆ‡æ¢å½“å‰ç»„ç»‡ã€èƒ½åŠ› |
| 5 | **å‰ç«¯ä»£ç ç»„ç»‡** | æ¢³ç†å‰ç«¯æ–°å¢é¡µé¢/ç»„ä»¶/Store/API çš„ä»£ç ç»„ç»‡ç»“æ„ |

---

## 2. RBAC æƒé™æ§åˆ¶è¯„ä¼°

### 2.1 ç°æœ‰æƒé™æ¨¡å‹

```
å½“å‰ä½“ç³»ï¼ˆä¸¤å±‚åˆ†ç¦»ï¼‰ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸€å±‚ï¼šç§Ÿæˆ·éš”ç¦»                               â”‚
â”‚ Â· User.TenantID â†’ æ•°æ®å¤©ç„¶éš”ç¦»                 â”‚
â”‚ Â· User.CanAccessAllTenants â†’ è·¨ç§Ÿæˆ·è®¿é—®        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬äºŒå±‚ï¼šç»„ç»‡è§’è‰²                               â”‚
â”‚ Â· OrganizationMember.Role = admin/editor/viewerâ”‚
â”‚ Â· æƒé™æ£€æŸ¥åœ¨ Handler/Service å±‚ç¡¬ç¼–ç            â”‚
â”‚ Â· æ— é€šç”¨ RBAC ä¸­é—´ä»¶                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ˜¯å¦éœ€è¦å®Œæ•´ RBACï¼Ÿ

**ç»“è®ºï¼šä¸éœ€è¦å®Œæ•´ RBACï¼Œé‡‡ç”¨ã€Œè¶…ç®¡æ ‡å¿— + ç»„ç»‡è§’è‰²ã€åˆ†å±‚å³å¯ã€‚**

ç†ç”±ï¼š

| ç»´åº¦ | å®Œæ•´ RBAC | è¶…ç®¡ + ç»„ç»‡è§’è‰²ï¼ˆæ¨èï¼‰ |
|------|-----------|----------------------|
| **å¤æ‚åº¦** | éœ€å»º role/permission/role_permission ä¸‰è¡¨ + æƒé™ä¸­é—´ä»¶ + ç®¡ç† UI | ä»…åŠ  `is_super_admin` å­—æ®µ + ä¸€ä¸ªä¸­é—´ä»¶ |
| **è§’è‰²ç²’åº¦** | å¯ä»»æ„ç»„åˆæƒé™ | ä¸‰ç§å›ºå®šè§’è‰² + è¶…ç®¡ |
| **å·²æœ‰åŸºç¡€** | `OrgMemberRole` å·²æ”¯æŒ admin/editor/viewer | ç›´æ¥å¤ç”¨ |
| **éœ€æ±‚åŒ¹é…** | è¶…é…â€”â€”å½“å‰éœ€æ±‚ä¸éœ€è¦ç»†ç²’åº¦æƒé™çŸ©é˜µ | ç²¾å‡†åŒ¹é… |
| **ç»´æŠ¤æˆæœ¬** | æƒé™çŸ©é˜µç»´æŠ¤å¤æ‚ï¼Œæ˜“å‡ºé”™ | è§’è‰²è¯­ä¹‰æ¸…æ™°ï¼Œé€»è¾‘ç®€å• |

### 2.3 æ¨èçš„æƒé™å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç§Ÿæˆ·ï¼ˆTenantï¼‰                             â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€ è¶…çº§ç®¡ç†å‘˜ (is_super_admin=true) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Â· ç®¡ç†ç»„ç»‡æ ‘ç»“æ„ï¼ˆåˆ›å»º/ç¼–è¾‘/åˆ é™¤/è°ƒæ•´å±‚çº§ï¼‰                    â”‚ â”‚
â”‚  â”‚  Â· ç®¡ç†å…¨å±€äººå‘˜ï¼ˆåˆ†é…åˆ°ç»„ç»‡ã€è®¾ç½®ç»„ç»‡ç®¡ç†å‘˜ï¼‰                    â”‚ â”‚
â”‚  â”‚  Â· ç‹¬å ï¼šæ¨¡å‹é…ç½®ã€Ollamaã€ç½‘ç»œæœç´¢ã€MCPã€ç³»ç»Ÿä¿¡æ¯ã€ç§Ÿæˆ·ç®¡ç†    â”‚ â”‚
â”‚  â”‚  Â· æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰çŸ¥è¯†åº“ï¼ˆæ— è§†å¯è§æ€§é™åˆ¶ï¼‰                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€ ç»„ç»‡ç®¡ç†å‘˜ (OrgMember.Role=admin) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Â· ç®¡ç†æœ¬ç»„ç»‡æˆå‘˜ï¼ˆæ·»åŠ /ç§»é™¤/è§’è‰²è°ƒæ•´ï¼‰                        â”‚ â”‚
â”‚  â”‚  Â· åˆ›å»ºå’Œç®¡ç†æœ¬ç»„ç»‡å†…çš„çŸ¥è¯†åº“                                  â”‚ â”‚
â”‚  â”‚  Â· æŸ¥çœ‹æœ¬ç»„ç»‡ + å…¨å±€å¯è§çŸ¥è¯†åº“                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€ æ™®é€šç”¨æˆ· (OrgMember.Role=editor/viewer) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Â· æŸ¥çœ‹ï¼šå½“å‰ç»„ç»‡çŸ¥è¯†åº“ + å…¨å±€å¯è§çŸ¥è¯†åº“ + ä¸ªäººçŸ¥è¯†åº“          â”‚ â”‚
â”‚  â”‚  Â· åˆ›å»ºä¸ªäººï¼ˆç§æœ‰ï¼‰çŸ¥è¯†åº“                                      â”‚ â”‚
â”‚  â”‚  Â· editor å¯åœ¨å½“å‰ç»„ç»‡å†…åˆ›å»ºç»„ç»‡çŸ¥è¯†åº“                          â”‚ â”‚
â”‚  â”‚  Â· viewer åªè¯»                                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 æƒé™åˆ¤æ–­æ€»è¡¨

| æ“ä½œ | è¶…çº§ç®¡ç†å‘˜ | ç»„ç»‡ admin | ç»„ç»‡ editor | ç»„ç»‡ viewer |
|------|-----------|-----------|-------------|-------------|
| ç³»ç»Ÿè®¾ç½®ï¼ˆæ¨¡å‹/Ollama/MCP ç­‰ï¼‰ | âœ… | âŒ | âŒ | âŒ |
| ç®¡ç†ç»„ç»‡æ ‘ | âœ… | âŒ | âŒ | âŒ |
| å…¨å±€äººå‘˜åˆ†é… | âœ… | âŒ | âŒ | âŒ |
| ç®¡ç†æœ¬ç»„ç»‡æˆå‘˜ | âœ… | âœ… | âŒ | âŒ |
| åˆ›å»ºå…¨å±€çŸ¥è¯†åº“ | âœ… | âŒ | âŒ | âŒ |
| åˆ›å»ºç»„ç»‡çŸ¥è¯†åº“ | âœ… | âœ… | âœ… | âŒ |
| åˆ›å»ºä¸ªäººçŸ¥è¯†åº“ | âœ… | âœ… | âœ… | âœ… |
| æŸ¥çœ‹å…¨å±€çŸ¥è¯†åº“ | âœ… | âœ… | âœ… | âœ… |
| æŸ¥çœ‹æœ¬ç»„ç»‡çŸ¥è¯†åº“ | âœ… | âœ… | âœ… | âœ… |
| æŸ¥çœ‹å…¶ä»–ç»„ç»‡çŸ¥è¯†åº“ | âœ… | âŒ | âŒ | âŒ |
| æŸ¥çœ‹ä¸ªäººçŸ¥è¯†åº“ï¼ˆè‡ªå·±çš„ï¼‰ | âœ… | âœ… | âœ… | âœ… |
| ç¼–è¾‘/åˆ é™¤çŸ¥è¯†åº“ | âœ… | æœ¬ç»„ç»‡çš„ | è‡ªå·±åˆ›å»ºçš„ | âŒ |
| åˆ‡æ¢å½“å‰ç»„ç»‡ | âœ… | âœ… | âœ… | âœ… |

---

## 3. ç°çŠ¶åˆ†æä¸æ‰©å±•ç­–ç•¥

### 3.1 ç°æœ‰æ¶æ„å…³é”®ç‚¹

| æ¨¡å— | ç°çŠ¶ | æ‰©å±•å½±å“ |
|------|------|----------|
| **Organization** | æ‰å¹³çš„å…±äº«ç©ºé—´ï¼Œæ—  `parent_id`ï¼Œæ— å±‚çº§ | éœ€åŠ  `parent_id` + æ ‘æŸ¥è¯¢ |
| **OrgMemberRole** | `admin` / `editor` / `viewer` ä¸‰çº§è§’è‰² | ç›´æ¥å¤ç”¨ï¼Œ`admin` = ç»„ç»‡ç®¡ç†å‘˜ |
| **User** | `can_access_all_tenants` ä¸ºå”¯ä¸€è¶…çº§æƒé™æ ‡å¿— | éœ€æ–°å¢ `is_super_admin` å­—æ®µ |
| **KnowledgeBase** | ä»… `tenant_id` éš”ç¦»ï¼Œæ—  visibility / created_by | éœ€æ–°å¢ `visibility` + `created_by` + `organization_id` |
| **Settings å¼¹çª—** | æ‰€æœ‰ç”¨æˆ·å‡å¯æ‰“å¼€ï¼Œå«æ¨¡å‹/Ollama/MCP ç­‰å…¨éƒ¨è®¾ç½® | éœ€æŒ‰è§’è‰²åˆ†æ®µæ˜¾ç¤º |
| **Auth ä¸­é—´ä»¶** | ä»… JWT + API Keyï¼Œæ— è§’è‰²æ£€æŸ¥ | éœ€æ–°å¢ `RequireSuperAdmin` ä¸­é—´ä»¶ |
| **è¿ç§»** | æœ€æ–°ç¼–å· 000012 | æ–°è¿ç§»ä» 000013 å¼€å§‹ |

### 3.2 æ‰©å±•ç­–ç•¥

æ ¸å¿ƒåŸåˆ™ï¼š**æœ€å°ä¾µå…¥å¼æ¼”è¿›â€”â€”åœ¨ç°æœ‰æ¨¡å‹ä¸Šæ·»åŠ å­—æ®µå’Œä¸­é—´ä»¶ï¼Œä¸å¼•å…¥æ–°çš„ RBAC è¡¨ä½“ç³»**ã€‚

```
æ¼”è¿›è·¯çº¿ï¼š
  æ‰å¹³ Organization â†’ å±‚çº§åŒ– Organizationï¼ˆåŠ  parent_id + pathï¼‰
  ä»… tenant_id çš„ KB â†’ visibility ä¸‰çº§å¯è§æ€§çš„ KB
  æ— è§’è‰² Settings â†’ è¶…ç®¡ç‹¬å  Settings + æ™®é€šç”¨æˆ·åªçœ‹å¸¸è§„è®¾ç½®
  æ— ã€Œå½“å‰ç»„ç»‡ã€ â†’ å‰ç«¯ store ç»´æŠ¤ currentOrganizationId + ç»„ç»‡åˆ‡æ¢å™¨
```

---

## 4. è¶…çº§ç®¡ç†å‘˜ä¸“ç”¨é¡µé¢

### 4.1 ç°æœ‰ Settings å¼¹çª—ç»“æ„

å½“å‰ `Settings.vue` æ˜¯ä¸€ä¸ª Teleport æ¨¡æ€å¼¹çª—ï¼Œå¯¼èˆªé¡¹å¦‚ä¸‹ï¼š

| å¯¼èˆªé¡¹ | ç»„ä»¶ | æ–°æƒé™ |
|--------|------|--------|
| å¸¸è§„è®¾ç½® | `GeneralSettings.vue` | æ‰€æœ‰ç”¨æˆ· |
| æ¨¡å‹ç®¡ç†ï¼ˆå« chat/embedding/rerank/vllm å­èœå•ï¼‰ | `ModelSettings.vue` | **ä»…è¶…ç®¡** |
| Ollama | `OllamaSettings.vue` | **ä»…è¶…ç®¡** |
| ç½‘ç»œæœç´¢ | `WebSearchSettings.vue` | **ä»…è¶…ç®¡** |
| MCP æœåŠ¡ | `McpSettings.vue` | **ä»…è¶…ç®¡** |
| ç³»ç»Ÿä¿¡æ¯ | `SystemInfo.vue` | **ä»…è¶…ç®¡** |
| ç§Ÿæˆ·ä¿¡æ¯ | `TenantInfo.vue` | **ä»…è¶…ç®¡** |
| API ä¿¡æ¯ | `ApiInfo.vue` | æ‰€æœ‰ç”¨æˆ·ï¼ˆæŸ¥çœ‹è‡ªå·±çš„ keyï¼‰ |

### 4.2 å‰ç«¯æ”¹é€ æ–¹æ¡ˆ

#### Settings å¯¼èˆªé¡¹æŒ‰è§’è‰²è¿‡æ»¤

```typescript
// Settings.vue â€” navItems æ”¹ä¸ºæŒ‰è§’è‰²è¿‡æ»¤
const authStore = useAuthStore()

// æ ‡è®°è¶…ç®¡ä¸“å±é¡¹
const allNavItems = [
  { key: 'general', icon: 'setting', label: t('general.title'), superAdminOnly: false },
  { key: 'models', icon: 'control-platform', label: t('settings.modelManagement'),
    superAdminOnly: true,
    children: [
      { key: 'chat', label: t('model.llmModel') },
      { key: 'embedding', label: t('model.embeddingModel') },
      { key: 'rerank', label: t('model.rerankModel') },
      { key: 'vllm', label: t('model.vlmModel') }
    ]
  },
  { key: 'ollama', icon: 'server', label: 'Ollama', superAdminOnly: true },
  { key: 'websearch', icon: 'search', label: t('settings.webSearchConfig'), superAdminOnly: true },
  { key: 'mcp', icon: 'tools', label: t('settings.mcpService'), superAdminOnly: true },
  { key: 'system', icon: 'info-circle', label: t('settings.systemSettings'), superAdminOnly: true },
  { key: 'tenant', icon: 'user-circle', label: t('settings.tenantInfo'), superAdminOnly: true },
  { key: 'api', icon: 'secured', label: t('settings.apiInfo'), superAdminOnly: false },
]

const navItems = computed(() =>
  allNavItems.filter(item => !item.superAdminOnly || authStore.isSuperAdmin)
)
```

#### UserMenu å¿«æ·å…¥å£æŒ‰è§’è‰²è¿‡æ»¤

```typescript
// UserMenu.vue â€” åªæœ‰è¶…ç®¡èƒ½çœ‹åˆ°æ¨¡å‹/Ollama/MCP å¿«æ·å…¥å£
const settingsShortcuts = computed(() => {
  const base = [{ key: 'general', label: 'å¸¸è§„è®¾ç½®' }]
  if (authStore.isSuperAdmin) {
    base.push(
      { key: 'models', label: 'æ¨¡å‹ç®¡ç†' },
      { key: 'ollama', label: 'Ollama' },
      { key: 'websearch', label: 'ç½‘ç»œæœç´¢' },
      { key: 'mcp', label: 'MCP æœåŠ¡' }
    )
  }
  return base
})
```

### 4.3 åç«¯ API ä¿æŠ¤

å¯¹åº”çš„åç«¯ API éœ€åŠ  `RequireSuperAdmin` ä¸­é—´ä»¶ï¼š

```go
// internal/router/router.go

// è¶…ç®¡ä¸“å± API
superAdmin := v1.Group("", middleware.RequireSuperAdmin())
{
    // æ¨¡å‹ç®¡ç†
    superAdmin.POST("/models", modelHandler.CreateModel)
    superAdmin.PUT("/models/:id", modelHandler.UpdateModel)
    superAdmin.DELETE("/models/:id", modelHandler.DeleteModel)

    // ç³»ç»Ÿé…ç½®
    superAdmin.GET("/system/info", systemHandler.GetSystemInfo)
    superAdmin.GET("/system/minio/buckets", systemHandler.ListMinioBuckets)

    // ç§Ÿæˆ· KV é…ç½®ï¼ˆagent-configã€conversation-configã€prompt-templates ç­‰ï¼‰
    superAdmin.PUT("/tenants/kv/:key", tenantHandler.SetKV)

    // ç»„ç»‡æ ‘ç®¡ç†
    orgTree := superAdmin.Group("/org-tree")
    {
        orgTree.GET("", orgTreeHandler.GetOrgTree)
        orgTree.POST("", orgTreeHandler.CreateOrgNode)
        orgTree.PUT("/:id", orgTreeHandler.UpdateOrgNode)
        orgTree.DELETE("/:id", orgTreeHandler.DeleteOrgNode)
        orgTree.PUT("/:id/move", orgTreeHandler.MoveOrgNode)
        orgTree.POST("/:id/users", orgTreeHandler.AssignUser)
        orgTree.DELETE("/:id/users/:user_id", orgTreeHandler.RemoveUser)
        orgTree.PUT("/:id/admin", orgTreeHandler.SetOrgAdmin)
    }
}

// æ‰€æœ‰ç”¨æˆ·å¯è¯»å–çš„ API ä¿æŒåŸè·¯ç”±ç»„
// GET /models â†’ åˆ—è¡¨ï¼ˆä»…è¿”å›å½“å‰ç§Ÿæˆ·å¯ç”¨æ¨¡å‹ï¼Œå†…ç½®æ¨¡å‹éšè—æ•æ„Ÿä¿¡æ¯ï¼‰
// GET /models/:id â†’ è¯¦æƒ…
// GET /tenants/kv/:key â†’ è¯»å–é…ç½®
```

### 4.4 è¶…çº§ç®¡ç†å‘˜ä¸­é—´ä»¶

```go
// internal/middleware/super_admin.go

package middleware

import (
    "net/http"
    "github.com/gin-gonic/gin"
    "weknora/internal/types"
)

func RequireSuperAdmin() gin.HandlerFunc {
    return func(c *gin.Context) {
        userInfo, exists := c.Get(types.UserContextKey)
        if !exists {
            c.AbortWithStatusJSON(http.StatusUnauthorized, gin.H{"error": "æœªè®¤è¯"})
            return
        }
        user, ok := userInfo.(*types.User)
        if !ok || !user.IsSuperAdmin {
            c.AbortWithStatusJSON(http.StatusForbidden, gin.H{"error": "éœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™"})
            return
        }
        c.Next()
    }
}
```

### 4.5 è¶…ç®¡æ–°å¢çš„ç®¡ç†é¡µé¢

é™¤äº†ç°æœ‰ Settings å¼¹çª—çš„æŒ‰è§’è‰²è¿‡æ»¤å¤–ï¼Œè¿˜éœ€æ–°å¢**ç‹¬ç«‹é¡µé¢**ï¼ˆéå¼¹çª—ï¼‰ç”¨äºç»„ç»‡æ ‘ç®¡ç†å’Œäººå‘˜ç®¡ç†ã€‚è¿™äº›é¡µé¢å…¥å£åœ¨å·¦ä¾§èœå•ï¼š

| é¡µé¢ | è·¯ç”± | å…¥å£ | æƒé™ |
|------|------|------|------|
| ç»„ç»‡æ ‘ç®¡ç† | `/platform/admin/org-tree` | å·¦ä¾§èœå•ï¼ˆè¶…ç®¡ä¸“å±ï¼‰ | è¶…ç®¡ |
| äººå‘˜ç®¡ç† | `/platform/admin/members` | å·¦ä¾§èœå•ï¼ˆè¶…ç®¡ä¸“å±ï¼‰ | è¶…ç®¡ |

---

## 5. ç»„ç»‡å½’å±ä¸ã€Œå½“å‰ç»„ç»‡ã€

### 5.1 ç”¨æˆ·ä¸ç»„ç»‡çš„å…³ç³»

```
ä¸€ä¸ªç”¨æˆ·å¯ä»¥å±äºå¤šä¸ªç»„ç»‡ï¼ˆé€šè¿‡ organization_members è¡¨ï¼‰ï¼š

ç”¨æˆ·å¼ ä¸‰
 â”œâ”€ æŠ€æœ¯ä¸­å¿ƒ    (role: editor)
 â”œâ”€ å‰ç«¯ç»„      (role: admin)    â† å…¼ä»»å‰ç«¯ç»„ç®¡ç†å‘˜
 â””â”€ AI å…´è¶£å°ç»„ (role: viewer)

ç”¨æˆ·æå››
 â””â”€ åç«¯ç»„      (role: editor)   â† åªå±äºä¸€ä¸ªç»„ç»‡
```

### 5.2 ã€Œå½“å‰ç»„ç»‡ã€æ¦‚å¿µ

ç”¨æˆ·åœ¨å‰ç«¯éœ€è¦ä¸€ä¸ª**å½“å‰æ´»è·ƒç»„ç»‡**çš„æ¦‚å¿µï¼Œå†³å®šç”¨æˆ·å½“å‰çœ‹åˆ°çš„çŸ¥è¯†åº“èŒƒå›´ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èœå•æ é¡¶éƒ¨                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  [æŠ€æœ¯ä¸­å¿ƒ â–¾]  â† ç»„ç»‡åˆ‡æ¢å™¨ï¼ˆä¸‹æ‹‰é€‰æ‹©ï¼‰     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                   â”‚
â”‚  å½“ currentOrganization = "æŠ€æœ¯ä¸­å¿ƒ" æ—¶             â”‚
â”‚  çŸ¥è¯†åº“åˆ—è¡¨æ˜¾ç¤ºï¼š                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“ å…¨å±€çŸ¥è¯†åº“                              â”‚   â”‚
â”‚  â”‚   Â· å…¬å¸è§„ç« åˆ¶åº¦                           â”‚   â”‚
â”‚  â”‚   Â· ä¼ä¸šæ–‡åŒ–æ‰‹å†Œ                           â”‚   â”‚
â”‚  â”‚                                           â”‚   â”‚
â”‚  â”‚ ğŸ“ æŠ€æœ¯ä¸­å¿ƒçŸ¥è¯†åº“                          â”‚   â”‚
â”‚  â”‚   Â· API è®¾è®¡è§„èŒƒ                           â”‚   â”‚
â”‚  â”‚   Â· åç«¯å¼€å‘æŒ‡å—                           â”‚   â”‚
â”‚  â”‚   Â· å‰ç«¯ç»„ä»¶åº“        â† å­ç»„ç»‡ KB ä¹Ÿå¯è§    â”‚   â”‚
â”‚  â”‚                                           â”‚   â”‚
â”‚  â”‚ ğŸ“ æˆ‘çš„çŸ¥è¯†åº“                              â”‚   â”‚
â”‚  â”‚   Â· æˆ‘çš„è¯»ä¹¦ç¬”è®°                           â”‚   â”‚
â”‚  â”‚   Â· é¢è¯•é¢˜æ•´ç†                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                   â”‚
â”‚  åˆ‡æ¢åˆ° "AI å…´è¶£å°ç»„" åï¼Œåˆ—è¡¨å˜ä¸ºï¼š                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“ å…¨å±€çŸ¥è¯†åº“ï¼ˆåŒä¸Šï¼‰                       â”‚   â”‚
â”‚  â”‚ ğŸ“ AI å…´è¶£å°ç»„çŸ¥è¯†åº“                       â”‚   â”‚
â”‚  â”‚   Â· è®ºæ–‡ç²¾é€‰                               â”‚   â”‚
â”‚  â”‚ ğŸ“ æˆ‘çš„çŸ¥è¯†åº“ï¼ˆåŒä¸Šï¼‰                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 å‰ç«¯çŠ¶æ€ç®¡ç†

```typescript
// stores/organization.ts æ‰©å±•

// æ–°å¢çŠ¶æ€
const currentOrganizationId = ref<string>(
  localStorage.getItem('current_org_id') || ''
)
const myOrganizationList = ref<Organization[]>([])  // ç”¨æˆ·æ‰€å±çš„æ‰€æœ‰ç»„ç»‡

// å½“å‰ç»„ç»‡
const currentOrganization = computed(() =>
  myOrganizationList.value.find(o => o.id === currentOrganizationId.value) || null
)

// åˆ‡æ¢å½“å‰ç»„ç»‡
function switchOrganization(orgId: string) {
  currentOrganizationId.value = orgId
  localStorage.setItem('current_org_id', orgId)
  // åˆ·æ–°çŸ¥è¯†åº“åˆ—è¡¨
  knowledgeStore.refreshKBList()
}

// åˆå§‹åŒ–ï¼šåŠ è½½ç”¨æˆ·æ‰€å±ç»„ç»‡ï¼Œè‹¥æ—  currentOrganizationId åˆ™å–ç¬¬ä¸€ä¸ª
async function initMyOrganizations() {
  myOrganizationList.value = await fetchMyOrganizations()
  if (!currentOrganizationId.value && myOrganizationList.value.length > 0) {
    switchOrganization(myOrganizationList.value[0].id)
  }
}
```

### 5.4 çŸ¥è¯†åº“å¯è§æ€§è§„åˆ™ï¼ˆåŸºäºå½“å‰ç»„ç»‡ï¼‰

å½“ç”¨æˆ·åˆ‡æ¢åˆ°ç»„ç»‡ A æ—¶ï¼Œç”¨æˆ·èƒ½çœ‹åˆ°çš„çŸ¥è¯†åº“ï¼š

| å¯è§æ€§ | æ¡ä»¶ | è¯´æ˜ |
|--------|------|------|
| `global` | `tenant_id` åŒ¹é… | å…¨å±€çŸ¥è¯†åº“ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½çœ‹åˆ° |
| `org` | `organization_id` = å½“å‰ç»„ç»‡ A æˆ– A çš„ç¥–å…ˆ/å­å­™ç»„ç»‡ | å½“å‰ç»„ç»‡åŠå…¶å±‚çº§é“¾ä¸Šçš„çŸ¥è¯†åº“ |
| `private` | `created_by` = å½“å‰ç”¨æˆ· ID | ä¸ªäººçŸ¥è¯†åº“ï¼Œè·Ÿéšç”¨æˆ·ï¼Œä¸éšç»„ç»‡åˆ‡æ¢å˜åŒ– |

```
canSeeKB(user, kb, currentOrgId):
  1. è¶…ç®¡ â†’ å…¨éƒ¨å¯è§
  2. kb.visibility == 'global' â†’ âœ…
  3. kb.visibility == 'private' && kb.created_by == user.id â†’ âœ…
  4. kb.visibility == 'org':
     a. è·å– currentOrgId çš„å®Œæ•´ç»„ç»‡æ ‘è·¯å¾„ï¼ˆç¥–å…ˆ + åä»£ï¼‰
     b. kb.organization_id åœ¨è¿™æ¡è·¯å¾„ä¸Š â†’ âœ…
  5. å¦åˆ™ â†’ âŒ
```

### 5.5 å­ç»„ç»‡ç»§æ‰¿è§„åˆ™

å½“çŸ¥è¯†åº“ `visibility='org'` ä¸”å½’å±ç»„ç»‡ A æ—¶ï¼š

```
æŠ€æœ¯ä¸­å¿ƒ (A)                 â† KB "API è§„èŒƒ" å½’å±æ­¤ç»„ç»‡
 â”œâ”€ å‰ç«¯ç»„ (B)
 â”œâ”€ åç«¯ç»„ (C)
 â””â”€ AI ç»„ (D)

ç”¨æˆ·å½“å‰ç»„ç»‡ = å‰ç«¯ç»„(B)ï¼š
  âœ… èƒ½çœ‹åˆ° "API è§„èŒƒ"    â† B æ˜¯ A çš„å­ç»„ç»‡ï¼ŒancestorPath åŒ¹é…
  âœ… èƒ½çœ‹åˆ° B çš„çŸ¥è¯†åº“     â† ç›´æ¥å½’å±
  âŒ çœ‹ä¸åˆ° Cã€D çš„çŸ¥è¯†åº“   â† å…„å¼Ÿç»„ç»‡ä¸å¯è§

ç”¨æˆ·å½“å‰ç»„ç»‡ = æŠ€æœ¯ä¸­å¿ƒ(A)ï¼š
  âœ… èƒ½çœ‹åˆ° "API è§„èŒƒ"    â† ç›´æ¥å½’å±
  âœ… èƒ½çœ‹åˆ° Bã€Cã€D çš„çŸ¥è¯†åº“ â† å­ç»„ç»‡å†…å®¹å‘çˆ¶ç»„ç»‡å¯è§
```

---

## 6. æ•°æ®åº“è®¾è®¡

### 6.1 `organizations` è¡¨æ‰©å±•

```sql
-- å±‚çº§ç»“æ„æ”¯æŒ
ALTER TABLE organizations ADD COLUMN IF NOT EXISTS parent_id VARCHAR(36) DEFAULT NULL;
ALTER TABLE organizations ADD COLUMN IF NOT EXISTS path TEXT DEFAULT '';
ALTER TABLE organizations ADD COLUMN IF NOT EXISTS level INTEGER DEFAULT 1;
ALTER TABLE organizations ADD COLUMN IF NOT EXISTS sort_order INTEGER DEFAULT 0;
ALTER TABLE organizations ADD COLUMN IF NOT EXISTS tenant_id BIGINT DEFAULT NULL;

CREATE INDEX IF NOT EXISTS idx_organizations_parent_id ON organizations(parent_id);
CREATE INDEX IF NOT EXISTS idx_organizations_path ON organizations USING btree(path);
CREATE INDEX IF NOT EXISTS idx_organizations_tenant_id ON organizations(tenant_id);

ALTER TABLE organizations ADD CONSTRAINT fk_organizations_parent
    FOREIGN KEY (parent_id) REFERENCES organizations(id) ON DELETE SET NULL;
```

| æ–°å¢å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|----------|------|------|
| `parent_id` | VARCHAR(36) | çˆ¶ç»„ç»‡ IDï¼ŒNULL ä¸ºé¡¶çº§ç»„ç»‡ |
| `path` | TEXT | ç‰©åŒ–è·¯å¾„ï¼Œå¦‚ `/root_id/parent_id/self_id`ï¼ŒåŠ é€Ÿå­æ ‘æŸ¥è¯¢ |
| `level` | INTEGER | å±‚çº§æ·±åº¦ï¼ˆ1=é¡¶çº§ï¼‰|
| `sort_order` | INTEGER | åŒçº§æ’åº |
| `tenant_id` | BIGINT | ç»„ç»‡æ‰€å±ç§Ÿæˆ· |

### 6.2 `users` è¡¨æ‰©å±•

```sql
ALTER TABLE users ADD COLUMN IF NOT EXISTS is_super_admin BOOLEAN DEFAULT false;
```

> **`can_access_all_tenants`** = è·¨ç§Ÿæˆ·åˆ‡æ¢èƒ½åŠ›ï¼ˆå¹³å°çº§ï¼‰  
> **`is_super_admin`** = ç§Ÿæˆ·å†…å…¨æƒç®¡ç†èƒ½åŠ›ï¼ˆç§Ÿæˆ·çº§ï¼‰  
> é€šå¸¸é¦–ä¸ªæ³¨å†Œç”¨æˆ·åŒæ—¶æ‹¥æœ‰ä¸¤è€…ã€‚

### 6.3 `knowledge_bases` è¡¨æ‰©å±•

```sql
ALTER TABLE knowledge_bases ADD COLUMN IF NOT EXISTS created_by VARCHAR(36) DEFAULT '';
ALTER TABLE knowledge_bases ADD COLUMN IF NOT EXISTS visibility VARCHAR(20) DEFAULT 'org';
ALTER TABLE knowledge_bases ADD COLUMN IF NOT EXISTS organization_id VARCHAR(36) DEFAULT NULL;

CREATE INDEX IF NOT EXISTS idx_knowledge_bases_created_by ON knowledge_bases(created_by);
CREATE INDEX IF NOT EXISTS idx_knowledge_bases_visibility ON knowledge_bases(visibility);
CREATE INDEX IF NOT EXISTS idx_knowledge_bases_organization_id ON knowledge_bases(organization_id);
```

| æ–°å¢å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|----------|------|------|
| `created_by` | VARCHAR(36) | åˆ›å»ºè€…ç”¨æˆ· ID |
| `visibility` | VARCHAR(20) | `global` / `org` / `private` |
| `organization_id` | VARCHAR(36) | å½’å±ç»„ç»‡ï¼ˆ`org` ç±»å‹å¿…å¡«ï¼‰ |

### 6.4 å®Œæ•´è¿ç§»

**`migrations/versioned/000013_org_tree_kb_visibility.up.sql`**

```sql
BEGIN;

-- 1. organizations è¡¨æ‰©å±•
ALTER TABLE organizations ADD COLUMN IF NOT EXISTS parent_id VARCHAR(36) DEFAULT NULL;
ALTER TABLE organizations ADD COLUMN IF NOT EXISTS path TEXT DEFAULT '';
ALTER TABLE organizations ADD COLUMN IF NOT EXISTS level INTEGER DEFAULT 1;
ALTER TABLE organizations ADD COLUMN IF NOT EXISTS sort_order INTEGER DEFAULT 0;
ALTER TABLE organizations ADD COLUMN IF NOT EXISTS tenant_id BIGINT DEFAULT NULL;

CREATE INDEX IF NOT EXISTS idx_organizations_parent_id ON organizations(parent_id);
CREATE INDEX IF NOT EXISTS idx_organizations_path ON organizations USING btree(path);
CREATE INDEX IF NOT EXISTS idx_organizations_tenant_id ON organizations(tenant_id);

DO $$
BEGIN
    IF NOT EXISTS (
        SELECT 1 FROM information_schema.table_constraints
        WHERE constraint_name = 'fk_organizations_parent'
    ) THEN
        ALTER TABLE organizations ADD CONSTRAINT fk_organizations_parent
            FOREIGN KEY (parent_id) REFERENCES organizations(id) ON DELETE SET NULL;
    END IF;
END $$;

UPDATE organizations SET path = '/' || id, level = 1
WHERE parent_id IS NULL AND (path IS NULL OR path = '');

-- 2. users è¡¨æ‰©å±•
ALTER TABLE users ADD COLUMN IF NOT EXISTS is_super_admin BOOLEAN DEFAULT false;
UPDATE users SET is_super_admin = true WHERE can_access_all_tenants = true;

-- 3. knowledge_bases è¡¨æ‰©å±•
ALTER TABLE knowledge_bases ADD COLUMN IF NOT EXISTS created_by VARCHAR(36) DEFAULT '';
ALTER TABLE knowledge_bases ADD COLUMN IF NOT EXISTS visibility VARCHAR(20) DEFAULT 'org';
ALTER TABLE knowledge_bases ADD COLUMN IF NOT EXISTS organization_id VARCHAR(36) DEFAULT NULL;

CREATE INDEX IF NOT EXISTS idx_knowledge_bases_created_by ON knowledge_bases(created_by);
CREATE INDEX IF NOT EXISTS idx_knowledge_bases_visibility ON knowledge_bases(visibility);
CREATE INDEX IF NOT EXISTS idx_knowledge_bases_organization_id ON knowledge_bases(organization_id);

COMMIT;
```

**`migrations/versioned/000013_org_tree_kb_visibility.down.sql`**

```sql
BEGIN;

DROP INDEX IF EXISTS idx_knowledge_bases_created_by;
DROP INDEX IF EXISTS idx_knowledge_bases_visibility;
DROP INDEX IF EXISTS idx_knowledge_bases_organization_id;
ALTER TABLE knowledge_bases DROP COLUMN IF EXISTS created_by;
ALTER TABLE knowledge_bases DROP COLUMN IF EXISTS visibility;
ALTER TABLE knowledge_bases DROP COLUMN IF EXISTS organization_id;

ALTER TABLE users DROP COLUMN IF EXISTS is_super_admin;

ALTER TABLE organizations DROP CONSTRAINT IF EXISTS fk_organizations_parent;
DROP INDEX IF EXISTS idx_organizations_parent_id;
DROP INDEX IF EXISTS idx_organizations_path;
DROP INDEX IF EXISTS idx_organizations_tenant_id;
ALTER TABLE organizations DROP COLUMN IF EXISTS parent_id;
ALTER TABLE organizations DROP COLUMN IF EXISTS path;
ALTER TABLE organizations DROP COLUMN IF EXISTS level;
ALTER TABLE organizations DROP COLUMN IF EXISTS sort_order;
ALTER TABLE organizations DROP COLUMN IF EXISTS tenant_id;

COMMIT;
```

### 6.5 ER å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   tenants   â”‚  1:N  â”‚             users                     â”‚
â”‚  id (PK)    â”‚â”€â”€â”€â”€â”€â”€â†’â”‚  id (PK)                              â”‚
â”‚  name       â”‚       â”‚  tenant_id (FK)                       â”‚
â”‚             â”‚       â”‚  is_super_admin (NEW)                 â”‚
â”‚             â”‚       â”‚  can_access_all_tenants               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                             â”‚
       â”‚     1:N                     â”‚ user_id
       â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚              organizations                    â”‚
       â”‚            â”‚  id (PK)                                      â”‚
       â”‚            â”‚  parent_id â†’ organizations.id (NEW, è‡ªå¼•ç”¨)   â”‚
       â”‚            â”‚  path (NEW, ç‰©åŒ–è·¯å¾„)                          â”‚
       â”‚            â”‚  level (NEW)    sort_order (NEW)               â”‚
       â”‚            â”‚  tenant_id (NEW)                               â”‚
       â”‚            â”‚  owner_id â†’ users.id                          â”‚
       â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                            â”‚ 1:N
       â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                  â”‚ organization_membersâ”‚
       â”‚                  â”‚  organization_id    â”‚
       â”‚                  â”‚  user_id            â”‚
       â”‚                  â”‚  role (admin/editor/ â”‚
       â”‚                  â”‚        viewer)      â”‚
       â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚     1:N     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚         knowledge_bases               â”‚
                     â”‚  id (PK)                              â”‚
                     â”‚  tenant_id                            â”‚
                     â”‚  created_by (NEW) â†’ users.id          â”‚
                     â”‚  visibility (NEW): global/org/private â”‚
                     â”‚  organization_id (NEW) â†’ org.id       â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. åç«¯å®ç°æ–¹æ¡ˆ

### 7.1 ç±»å‹å®šä¹‰å˜æ›´

#### Organization æ–°å¢å­—æ®µï¼ˆ`internal/types/organization.go`ï¼‰

```go
type Organization struct {
    // ... ç°æœ‰å­—æ®µä¿æŒä¸å˜ ...

    // æ–°å¢ï¼šå±‚çº§ç»“æ„
    ParentID  *string `json:"parent_id" gorm:"type:varchar(36);index"`
    Path      string  `json:"path" gorm:"type:text"`
    Level     int     `json:"level" gorm:"default:1"`
    SortOrder int     `json:"sort_order" gorm:"default:0"`
    TenantID  uint64  `json:"tenant_id" gorm:"index"`

    // éæŒä¹…åŒ–
    Children  []*Organization `json:"children,omitempty" gorm:"-"`
}

// æ–°å¢è¯·æ±‚ç±»å‹
type CreateOrgTreeNodeRequest struct {
    Name        string  `json:"name" binding:"required,max=255"`
    Description string  `json:"description"`
    ParentID    *string `json:"parent_id"`
    SortOrder   int     `json:"sort_order"`
}

type MoveOrgNodeRequest struct {
    NewParentID *string `json:"new_parent_id"`
}

type OrgTreeNode struct {
    Organization
    Children []*OrgTreeNode `json:"children"`
}

type AssignUserRequest struct {
    UserID string          `json:"user_id" binding:"required"`
    Role   OrgMemberRole   `json:"role" binding:"required"`
}
```

#### User æ–°å¢å­—æ®µï¼ˆ`internal/types/user.go`ï¼‰

```go
type User struct {
    // ... ç°æœ‰å­—æ®µ ...
    IsSuperAdmin bool `json:"is_super_admin" gorm:"default:false"`
}
```

#### KnowledgeBase æ–°å¢å­—æ®µï¼ˆ`internal/types/knowledgebase.go`ï¼‰

```go
const (
    KBVisibilityGlobal  = "global"
    KBVisibilityOrg     = "org"
    KBVisibilityPrivate = "private"
)

type KnowledgeBase struct {
    // ... ç°æœ‰å­—æ®µ ...
    CreatedBy      string `json:"created_by" gorm:"type:varchar(36)"`
    Visibility     string `json:"visibility" gorm:"type:varchar(20);default:'org'"`
    OrganizationID string `json:"organization_id" gorm:"type:varchar(36);index"`
}
```

### 7.2 Service å±‚

#### ç»„ç»‡æ ‘æœåŠ¡ï¼ˆ`internal/application/service/org_tree.go`ï¼‰

```go
type OrgTreeService interface {
    CreateNode(tenantID uint64, req *types.CreateOrgTreeNodeRequest, creatorID string) (*types.Organization, error)
    UpdateNode(tenantID uint64, orgID string, req *types.UpdateOrgTreeNodeRequest) error
    DeleteNode(tenantID uint64, orgID string) error
    MoveNode(tenantID uint64, orgID string, newParentID *string) error
    GetTree(tenantID uint64) ([]*types.OrgTreeNode, error)
    GetOrgAndDescendantIDs(orgID string) ([]string, error)
    GetOrgAndAncestorIDs(orgID string) ([]string, error)
    AssignUserToOrg(userID string, orgID string, role types.OrgMemberRole) error
    RemoveUserFromOrg(userID string, orgID string) error
    SetOrgAdmin(userID string, orgID string) error
    GetUserOrganizations(userID string) ([]types.Organization, error)
}
```

é‡ç‚¹æ–¹æ³•â€”â€”è·å–ç”¨æˆ·æ‰€å±ç»„ç»‡ï¼š

```go
func (s *orgTreeService) GetUserOrganizations(userID string) ([]types.Organization, error) {
    // SELECT o.* FROM organizations o
    // JOIN organization_members om ON o.id = om.organization_id
    // WHERE om.user_id = ?
    // ORDER BY o.level, o.sort_order
    members, err := s.orgMemberRepo.ListByUserID(userID)
    if err != nil { return nil, err }
    orgIDs := make([]string, len(members))
    for i, m := range members { orgIDs[i] = m.OrganizationID }
    return s.orgRepo.GetByIDs(orgIDs)
}
```

#### çŸ¥è¯†åº“å¯è§æ€§æœåŠ¡ï¼ˆ`internal/application/service/kb_visibility.go`ï¼‰

```go
type KBVisibilityService interface {
    // æ ¹æ®å½“å‰ç»„ç»‡ + ç”¨æˆ·è¿‡æ»¤å¯è®¿é—®çš„ KB åˆ—è¡¨
    ListAccessibleKBs(tenantID uint64, userID string, currentOrgID string) ([]*types.KnowledgeBase, error)
    CanAccessKB(tenantID uint64, userID string, currentOrgID string, kb *types.KnowledgeBase) (bool, error)
    CanManageKB(tenantID uint64, userID string, kb *types.KnowledgeBase) (bool, error)
}
```

æ ¸å¿ƒæŸ¥è¯¢é€»è¾‘ï¼š

```go
func (s *kbVisibilityService) ListAccessibleKBs(
    tenantID uint64, userID string, currentOrgID string,
) ([]*types.KnowledgeBase, error) {
    user, _ := s.userRepo.FindByID(userID)

    // è¶…ç®¡ï¼šå…¨éƒ¨å¯è§
    if user.IsSuperAdmin {
        return s.kbRepo.ListKnowledgeBasesByTenantID(tenantID)
    }

    // è·å–å½“å‰ç»„ç»‡çš„å®Œæ•´è·¯å¾„é“¾ï¼ˆç¥–å…ˆ + åä»£ IDï¼‰
    relatedOrgIDs, _ := s.orgTreeService.GetOrgAndDescendantIDs(currentOrgID)
    ancestorIDs, _ := s.orgTreeService.GetOrgAndAncestorIDs(currentOrgID)
    allRelatedOrgIDs := append(relatedOrgIDs, ancestorIDs...)
    allRelatedOrgIDs = deduplicate(allRelatedOrgIDs)

    // SQL: visibility='global' OR (visibility='org' AND organization_id IN (?))
    //      OR (visibility='private' AND created_by=?)
    return s.kbRepo.ListAccessibleKBs(tenantID, userID, allRelatedOrgIDs)
}
```

### 7.3 Handler å±‚

#### çŸ¥è¯†åº“åˆ—è¡¨â€”â€”å¢åŠ  `current_org_id` å‚æ•°

```go
func (h *KnowledgeBaseHandler) ListKnowledgeBases(c *gin.Context) {
    tenantID := c.GetUint64(types.TenantIDContextKey)
    user := c.MustGet(types.UserContextKey).(*types.User)
    currentOrgID := c.Query("current_org_id")  // å‰ç«¯ä¼ å…¥å½“å‰ç»„ç»‡ ID

    kbs, err := h.kbVisibilityService.ListAccessibleKBs(
        tenantID, user.ID, currentOrgID,
    )
    if err != nil {
        c.JSON(500, gin.H{"error": err.Error()})
        return
    }
    c.JSON(200, kbs)
}
```

#### çŸ¥è¯†åº“åˆ›å»ºâ€”â€”è®¾ç½® created_by + éªŒè¯ visibility

```go
func (h *KnowledgeBaseHandler) CreateKnowledgeBase(c *gin.Context) {
    // ... ç°æœ‰ç»‘å®š ...
    user := c.MustGet(types.UserContextKey).(*types.User)
    req.CreatedBy = user.ID

    if req.Visibility == "" {
        req.Visibility = types.KBVisibilityPrivate
    }

    switch req.Visibility {
    case types.KBVisibilityGlobal:
        if !user.IsSuperAdmin {
            c.JSON(403, gin.H{"error": "åªæœ‰è¶…çº§ç®¡ç†å‘˜å¯åˆ›å»ºå…¨å±€çŸ¥è¯†åº“"})
            return
        }
    case types.KBVisibilityOrg:
        if req.OrganizationID == "" {
            c.JSON(400, gin.H{"error": "ç»„ç»‡çŸ¥è¯†åº“å¿…é¡»æŒ‡å®š organization_id"})
            return
        }
        // éªŒè¯ç”¨æˆ·æ˜¯è¯¥ç»„ç»‡çš„ admin æˆ– editor
        role, err := h.orgMemberService.GetMemberRole(req.OrganizationID, user.ID)
        if err != nil || role == types.OrgRoleViewer {
            c.JSON(403, gin.H{"error": "æ— æƒåœ¨è¯¥ç»„ç»‡åˆ›å»ºçŸ¥è¯†åº“"})
            return
        }
    case types.KBVisibilityPrivate:
        // æ‰€æœ‰ç”¨æˆ·å‡å¯
    }
    // ... åˆ›å»ºé€»è¾‘ ...
}
```

### 7.4 æ–°å¢ API æ€»è§ˆ

| éœ€è¦è¶…ç®¡ | API è·¯ç”± |
|----------|----------|
| âœ… | `POST/PUT/DELETE /api/v1/models/*` |
| âœ… | `GET /api/v1/system/info` |
| âœ… | `PUT /api/v1/tenants/kv/:key` |
| âœ… | `GET/POST/PUT/DELETE /api/v1/org-tree/*` |
| âŒ | `GET /api/v1/models` (åˆ—è¡¨/è¯¦æƒ…ä¿æŒå…¨ç”¨æˆ·å¯è¯») |
| âŒ | `GET /api/v1/tenants/kv/:key` (é…ç½®è¯»å–ä¿æŒå…¨ç”¨æˆ·å¯è¯») |

æ–°å¢ APIï¼š

| æ–¹æ³• | è·¯å¾„ | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| `GET` | `/api/v1/org-tree` | è¶…ç®¡ | è·å–ç»„ç»‡æ ‘ |
| `POST` | `/api/v1/org-tree` | è¶…ç®¡ | åˆ›å»ºç»„ç»‡èŠ‚ç‚¹ |
| `PUT` | `/api/v1/org-tree/:id` | è¶…ç®¡ | æ›´æ–°ç»„ç»‡èŠ‚ç‚¹ |
| `DELETE` | `/api/v1/org-tree/:id` | è¶…ç®¡ | åˆ é™¤ç»„ç»‡èŠ‚ç‚¹ |
| `PUT` | `/api/v1/org-tree/:id/move` | è¶…ç®¡ | ç§»åŠ¨ç»„ç»‡èŠ‚ç‚¹ |
| `POST` | `/api/v1/org-tree/:id/users` | è¶…ç®¡ | åˆ†é…ç”¨æˆ·åˆ°ç»„ç»‡ |
| `DELETE` | `/api/v1/org-tree/:id/users/:uid` | è¶…ç®¡ | ä»ç»„ç»‡ç§»é™¤ç”¨æˆ· |
| `PUT` | `/api/v1/org-tree/:id/admin` | è¶…ç®¡ | è®¾ç½®ç»„ç»‡ç®¡ç†å‘˜ |
| `GET` | `/api/v1/my-organizations` | ç™»å½•ç”¨æˆ· | è·å–å½“å‰ç”¨æˆ·æ‰€å±ç»„ç»‡åˆ—è¡¨ |

### 7.5 DI å®¹å™¨æ³¨å†Œ

```go
// internal/container/container.go æ–°å¢
container.Provide(service.NewOrgTreeService)
container.Provide(service.NewKBVisibilityService)
container.Provide(handler.NewOrgTreeHandler)
```

---

## 8. å‰ç«¯ä»£ç ç»„ç»‡

### 8.1 æ¦‚è§ˆï¼šç°æœ‰ç›®å½•ç»“æ„ vs æ–°å¢

```
frontend/src/
â”œâ”€â”€ api/                              # API å±‚
â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ agent/
â”‚   â”œâ”€â”€ chat/
â”‚   â”œâ”€â”€ initialization/
â”‚   â”œâ”€â”€ knowledge-base/
â”‚   â”‚   â””â”€â”€ index.ts                  # [ä¿®æ”¹] æ–°å¢ visibility/organization_id å‚æ•°
â”‚   â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ organization/
â”‚   â”‚   â””â”€â”€ index.ts                  # [ä¿®æ”¹] æ–°å¢ getMyOrganizations()
â”‚   â”œâ”€â”€ org-tree/                     # â˜… æ–°å¢ç›®å½•
â”‚   â”‚   â””â”€â”€ index.ts                  # ç»„ç»‡æ ‘ç®¡ç† API
â”‚   â”œâ”€â”€ system/
â”‚   â”œâ”€â”€ tenant/
â”‚   â”œâ”€â”€ mcp-service.ts
â”‚   â””â”€â”€ web-search.ts
â”‚
â”œâ”€â”€ stores/                           # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ auth.ts                       # [ä¿®æ”¹] æ–°å¢ isSuperAdmin computed
â”‚   â”œâ”€â”€ organization.ts               # [ä¿®æ”¹] æ–°å¢ currentOrganizationId + switchOrganization
â”‚   â”œâ”€â”€ settings.ts
â”‚   â”œâ”€â”€ menu.ts                       # [ä¿®æ”¹] è¶…ç®¡èœå•é¡¹
â”‚   â”œâ”€â”€ ui.ts
â”‚   â””â”€â”€ orgTree.ts                    # â˜… æ–°å¢ï¼šç»„ç»‡æ ‘çŠ¶æ€ç®¡ç†
â”‚
â”œâ”€â”€ components/                       # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ menu.vue                      # [ä¿®æ”¹] è¶…ç®¡èœå•å…¥å£ + ç»„ç»‡åˆ‡æ¢å™¨
â”‚   â”œâ”€â”€ UserMenu.vue                  # [ä¿®æ”¹] è¶…ç®¡å¿«æ·è®¾ç½®å…¥å£è¿‡æ»¤
â”‚   â”œâ”€â”€ ListSpaceSidebar.vue          # [ä¿®æ”¹] æŒ‰å¯è§æ€§åˆ†ç»„æ˜¾ç¤º KB
â”‚   â”œâ”€â”€ OrganizationSwitcher.vue      # â˜… æ–°å¢ï¼šç»„ç»‡åˆ‡æ¢ä¸‹æ‹‰ç»„ä»¶
â”‚   â””â”€â”€ OrgTreeSelector.vue           # â˜… æ–°å¢ï¼šç»„ç»‡æ ‘é€‰æ‹©å™¨ï¼ˆåˆ›å»º KB æ—¶é€‰æ‹©å½’å±ç»„ç»‡ï¼‰
â”‚
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â””â”€â”€ Settings.vue              # [ä¿®æ”¹] navItems æŒ‰ is_super_admin è¿‡æ»¤
â”‚   â”‚
â”‚   â”œâ”€â”€ knowledge/
â”‚   â”‚   â”œâ”€â”€ KnowledgeBaseList.vue     # [ä¿®æ”¹] ä¼ å…¥ current_org_idï¼ŒæŒ‰å¯è§æ€§åˆ†ç»„
â”‚   â”‚   â”œâ”€â”€ KnowledgeBaseEditorModal.vue  # [ä¿®æ”¹] æ–°å¢ visibility + organization é€‰æ‹©
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ admin/                        # â˜… æ–°å¢ç›®å½•ï¼šè¶…ç®¡ä¸“ç”¨é¡µé¢
â”‚   â”‚   â”œâ”€â”€ AdminLayout.vue           # è¶…ç®¡é¡µé¢å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ OrgTreeManage.vue         # ç»„ç»‡æ ‘ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ MemberManage.vue          # å…¨å±€äººå‘˜ç®¡ç†
â”‚   â”‚   â””â”€â”€ components/               # è¶…ç®¡é¡µé¢å­ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ OrgTreeEditor.vue     # ç»„ç»‡æ ‘å¯è§†åŒ–ç¼–è¾‘å™¨
â”‚   â”‚       â”œâ”€â”€ MemberTable.vue       # äººå‘˜åˆ—è¡¨è¡¨æ ¼
â”‚   â”‚       â””â”€â”€ AssignOrgDialog.vue   # åˆ†é…ç»„ç»‡å¼¹çª—
â”‚   â”‚
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ router/
â”‚   â””â”€â”€ index.ts                      # [ä¿®æ”¹] æ–°å¢ admin è·¯ç”± + è¶…ç®¡å®ˆå«
â”‚
â””â”€â”€ i18n/
    â””â”€â”€ locales/
        â”œâ”€â”€ zh-CN.ts                  # [ä¿®æ”¹] æ–°å¢ç¿»è¯‘é”®
        â””â”€â”€ en.ts                     # [ä¿®æ”¹] æ–°å¢ç¿»è¯‘é”®
```

### 8.2 æ–°å¢æ–‡ä»¶è¯¦ç»†è¯´æ˜

#### 8.2.1 `frontend/src/api/org-tree/index.ts` â€”â€” ç»„ç»‡æ ‘ API

```typescript
import request from '@/utils/request'

export interface OrgTreeNode {
  id: string
  name: string
  description: string
  parent_id: string | null
  level: number
  sort_order: number
  user_count?: number
  children: OrgTreeNode[]
}

export interface CreateOrgNodeReq {
  name: string
  description?: string
  parent_id?: string | null
  sort_order?: number
}

export interface AssignUserReq {
  user_id: string
  role: 'admin' | 'editor' | 'viewer'
}

// ç»„ç»‡æ ‘CRUDï¼ˆè¶…ç®¡ï¼‰
export const getOrgTree = () => request.get<OrgTreeNode[]>('/org-tree')
export const createOrgNode = (data: CreateOrgNodeReq) => request.post('/org-tree', data)
export const updateOrgNode = (id: string, data: Partial<CreateOrgNodeReq>) => request.put(`/org-tree/${id}`, data)
export const deleteOrgNode = (id: string) => request.delete(`/org-tree/${id}`)
export const moveOrgNode = (id: string, newParentId: string | null) =>
  request.put(`/org-tree/${id}/move`, { new_parent_id: newParentId })

// æˆå‘˜ç®¡ç†ï¼ˆè¶…ç®¡ï¼‰
export const assignUserToOrg = (orgId: string, data: AssignUserReq) =>
  request.post(`/org-tree/${orgId}/users`, data)
export const removeUserFromOrg = (orgId: string, userId: string) =>
  request.delete(`/org-tree/${orgId}/users/${userId}`)
export const setOrgAdmin = (orgId: string, userId: string) =>
  request.put(`/org-tree/${orgId}/admin`, { user_id: userId })
```

#### 8.2.2 `frontend/src/stores/orgTree.ts` â€”â€” ç»„ç»‡æ ‘ Store

```typescript
import { defineStore } from 'pinia'
import { ref } from 'vue'
import * as orgTreeApi from '@/api/org-tree'

export const useOrgTreeStore = defineStore('orgTree', () => {
  const tree = ref<orgTreeApi.OrgTreeNode[]>([])
  const loading = ref(false)

  async function fetchTree() {
    loading.value = true
    try {
      tree.value = await orgTreeApi.getOrgTree()
    } finally {
      loading.value = false
    }
  }

  async function createNode(data: orgTreeApi.CreateOrgNodeReq) {
    await orgTreeApi.createOrgNode(data)
    await fetchTree()
  }

  async function updateNode(id: string, data: Partial<orgTreeApi.CreateOrgNodeReq>) {
    await orgTreeApi.updateOrgNode(id, data)
    await fetchTree()
  }

  async function deleteNode(id: string) {
    await orgTreeApi.deleteOrgNode(id)
    await fetchTree()
  }

  async function moveNode(id: string, newParentId: string | null) {
    await orgTreeApi.moveOrgNode(id, newParentId)
    await fetchTree()
  }

  return { tree, loading, fetchTree, createNode, updateNode, deleteNode, moveNode }
})
```

#### 8.2.3 `frontend/src/components/OrganizationSwitcher.vue` â€”â€” ç»„ç»‡åˆ‡æ¢å™¨

```vue
<!-- æ”¾åœ¨èœå•æ é¡¶éƒ¨ï¼ŒLogo ä¸‹æ–¹ -->
<template>
  <t-select
    v-model="orgStore.currentOrganizationId"
    :options="orgOptions"
    :placeholder="$t('org.selectOrg')"
    size="small"
    @change="handleSwitch"
  />
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useOrganizationStore } from '@/stores/organization'

const orgStore = useOrganizationStore()

const orgOptions = computed(() =>
  orgStore.myOrganizationList.map(org => ({
    label: org.name,
    value: org.id,
  }))
)

function handleSwitch(orgId: string) {
  orgStore.switchOrganization(orgId)
}
</script>
```

#### 8.2.4 `frontend/src/components/OrgTreeSelector.vue` â€”â€” æ ‘å½¢ç»„ç»‡é€‰æ‹©å™¨

```vue
<!-- åˆ›å»ºçŸ¥è¯†åº“å¼¹çª—ä¸­é€‰æ‹©å½’å±ç»„ç»‡æ—¶ä½¿ç”¨ -->
<template>
  <t-tree-select
    v-model="modelValue"
    :data="treeData"
    :tree-props="{ keys: { value: 'id', label: 'name', children: 'children' } }"
    :placeholder="$t('org.selectTargetOrg')"
    clearable
  />
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useOrgTreeStore } from '@/stores/orgTree'

const modelValue = defineModel<string>()
const orgTreeStore = useOrgTreeStore()

const treeData = computed(() => orgTreeStore.tree)
</script>
```

#### 8.2.5 `frontend/src/views/admin/AdminLayout.vue` â€”â€” è¶…ç®¡é¡µé¢å¸ƒå±€

```vue
<template>
  <div class="admin-layout">
    <div class="admin-sidebar">
      <h3>{{ $t('admin.title') }}</h3>
      <t-menu :value="activeMenu" @change="handleMenuChange">
        <t-menu-item value="org-tree">
          <template #icon><t-icon name="tree" /></template>
          {{ $t('admin.orgTree') }}
        </t-menu-item>
        <t-menu-item value="members">
          <template #icon><t-icon name="usergroup" /></template>
          {{ $t('admin.members') }}
        </t-menu-item>
      </t-menu>
    </div>
    <div class="admin-content">
      <RouterView />
    </div>
  </div>
</template>
```

#### 8.2.6 `frontend/src/views/admin/OrgTreeManage.vue` â€”â€” ç»„ç»‡æ ‘ç®¡ç†

```vue
<template>
  <div class="org-tree-manage">
    <div class="header">
      <h2>{{ $t('admin.orgTree') }}</h2>
      <t-button theme="primary" @click="handleCreate">
        {{ $t('admin.createOrg') }}
      </t-button>
    </div>

    <!-- ç»„ç»‡æ ‘å¯è§†åŒ–ï¼ˆä½¿ç”¨ TDesign Tree ç»„ä»¶ï¼‰ -->
    <t-tree
      :data="orgTreeStore.tree"
      :keys="{ value: 'id', label: 'name', children: 'children' }"
      hover
      activable
      draggable
      @drag-end="handleDragEnd"
    >
      <template #operations="{ node }">
        <t-space size="small">
          <t-button size="small" variant="text" @click="handleEdit(node)">ç¼–è¾‘</t-button>
          <t-button size="small" variant="text" @click="handleManageMembers(node)">æˆå‘˜</t-button>
          <t-popconfirm :content="$t('admin.confirmDelete')" @confirm="handleDelete(node)">
            <t-button size="small" variant="text" theme="danger">åˆ é™¤</t-button>
          </t-popconfirm>
        </t-space>
      </template>
    </t-tree>
  </div>
</template>
```

#### 8.2.7 `frontend/src/views/admin/MemberManage.vue` â€”â€” äººå‘˜ç®¡ç†

```vue
<template>
  <div class="member-manage">
    <div class="header">
      <h2>{{ $t('admin.members') }}</h2>
      <t-input v-model="searchKeyword" :placeholder="$t('admin.searchUser')" />
    </div>

    <t-table :data="memberList" :columns="columns" row-key="id">
      <template #organizations="{ row }">
        <t-tag v-for="org in row.organizations" :key="org.id" class="org-tag">
          {{ org.name }} ({{ org.role }})
        </t-tag>
      </template>
      <template #actions="{ row }">
        <t-button size="small" variant="text" @click="handleAssignOrg(row)">
          {{ $t('admin.assignOrg') }}
        </t-button>
        <t-button
          v-if="!row.is_super_admin"
          size="small" variant="text"
          @click="handleSetSuperAdmin(row)"
        >
          {{ $t('admin.setSuperAdmin') }}
        </t-button>
      </template>
    </t-table>
  </div>
</template>
```

### 8.3 ä¿®æ”¹æ–‡ä»¶è¯¦ç»†è¯´æ˜

#### 8.3.1 `frontend/src/stores/auth.ts` â€”â€” æ–°å¢è¶…ç®¡æ ‡å¿—

```typescript
// æ–°å¢ computed
const isSuperAdmin = computed(() => user.value?.is_super_admin ?? false)

// å¯¼å‡ºä¸­æ–°å¢
return { ..., isSuperAdmin }
```

#### 8.3.2 `frontend/src/stores/organization.ts` â€”â€” æ–°å¢å½“å‰ç»„ç»‡ç®¡ç†

```typescript
// æ–°å¢çŠ¶æ€
const currentOrganizationId = ref<string>(
  localStorage.getItem('weknora_current_org_id') || ''
)
const myOrganizationList = ref<Organization[]>([])

// æ–°å¢ computed
const currentOrganization = computed(() =>
  myOrganizationList.value.find(o => o.id === currentOrganizationId.value) || null
)

// æ–°å¢æ–¹æ³•
function switchOrganization(orgId: string) {
  currentOrganizationId.value = orgId
  localStorage.setItem('weknora_current_org_id', orgId)
}

async function fetchMyOrganizations() {
  // GET /api/v1/my-organizations
  myOrganizationList.value = await api.getMyOrganizations()
  // è‹¥æ— å½“å‰ç»„ç»‡åˆ™é»˜è®¤é€‰ç¬¬ä¸€ä¸ª
  if (!currentOrganizationId.value && myOrganizationList.value.length > 0) {
    switchOrganization(myOrganizationList.value[0].id)
  }
}
```

#### 8.3.3 `frontend/src/api/knowledge-base/index.ts` â€”â€” å‚æ•°æ‰©å±•

```typescript
// åˆ›å»ºæ¥å£æ–°å¢å­—æ®µ
interface CreateKBRequest {
  // ... ç°æœ‰ ...
  visibility?: 'global' | 'org' | 'private'    // æ–°å¢
  organization_id?: string                       // æ–°å¢
}

// åˆ—è¡¨æ¥å£å¢åŠ  current_org_id å‚æ•°
export const listKnowledgeBases = (params?: {
  current_org_id?: string     // æ–°å¢
}) => request.get('/knowledge-bases', { params })
```

#### 8.3.4 `frontend/src/api/organization/index.ts` â€”â€” æ–°å¢æ–¹æ³•

```typescript
// è·å–å½“å‰ç”¨æˆ·æ‰€å±ç»„ç»‡åˆ—è¡¨ï¼ˆæ–°å¢ï¼‰
export const getMyOrganizations = () =>
  request.get<Organization[]>('/my-organizations')
```

#### 8.3.5 `frontend/src/components/menu.vue` â€”â€” èœå•æ”¹é€ 

```
æ”¹é€ è¦ç‚¹ï¼š
1. Logo ä¸‹æ–¹æ’å…¥ OrganizationSwitcher ç»„ä»¶
2. è¶…ç®¡ç”¨æˆ·æ˜¾ç¤ºé¢å¤–èœå•é¡¹ï¼šç»„ç»‡ç®¡ç†ã€äººå‘˜ç®¡ç†
3. TenantSelector ä¿æŒï¼ˆä»… canAccessAllTenants ç”¨æˆ·å¯è§ï¼‰
```

```vue
<!-- èœå•å¸ƒå±€ -->
<div class="menu-container">
  <Logo />
  <TenantSelector v-if="authStore.canAccessAllTenants" />
  <OrganizationSwitcher />                     <!-- â˜… æ–°å¢ -->

  <!-- å¸¸è§„èœå• -->
  <MenuItem icon="zhishiku" path="knowledge-bases" />
  <MenuItem icon="agent" path="agents" />
  <MenuItem icon="organization" path="organizations" />
  <MenuItem icon="prefixIcon" path="creatChat" />

  <!-- è¶…ç®¡ä¸“å± -->
  <template v-if="authStore.isSuperAdmin">     <!-- â˜… æ–°å¢ -->
    <Divider />
    <MenuItem icon="tree" path="admin/org-tree" label="ç»„ç»‡ç®¡ç†" />
    <MenuItem icon="usergroup" path="admin/members" label="äººå‘˜ç®¡ç†" />
  </template>

  <UserMenu />
</div>
```

#### 8.3.6 `frontend/src/views/settings/Settings.vue` â€”â€” æŒ‰è§’è‰²è¿‡æ»¤å¯¼èˆª

```typescript
// navItems æ”¹ä¸º computedï¼Œè¿‡æ»¤è¶…ç®¡ä¸“å±é¡¹
const navItems = computed(() => {
  const all = [
    { key: 'general', icon: 'setting', label: t('general.title'), superAdminOnly: false },
    { key: 'models', icon: 'control-platform', label: t('settings.modelManagement'),
      superAdminOnly: true,
      children: [ /* chat/embedding/rerank/vllm */ ]
    },
    { key: 'ollama', icon: 'server', label: 'Ollama', superAdminOnly: true },
    { key: 'websearch', icon: 'search', label: t('settings.webSearchConfig'), superAdminOnly: true },
    { key: 'mcp', icon: 'tools', label: t('settings.mcpService'), superAdminOnly: true },
    { key: 'system', icon: 'info-circle', label: t('settings.systemSettings'), superAdminOnly: true },
    { key: 'tenant', icon: 'user-circle', label: t('settings.tenantInfo'), superAdminOnly: true },
    { key: 'api', icon: 'secured', label: t('settings.apiInfo'), superAdminOnly: false },
  ]
  return all.filter(item => !item.superAdminOnly || authStore.isSuperAdmin)
})
```

#### 8.3.7 `frontend/src/views/knowledge/KnowledgeBaseList.vue` â€”â€” å¯è§æ€§åˆ†ç»„

```
æ”¹é€ è¦ç‚¹ï¼š
1. è¯·æ±‚æ—¶ä¼ å…¥ current_org_id
2. å·¦ä¾§ ListSpaceSidebar æ”¹ä¸ºæŒ‰å¯è§æ€§åˆ†ç»„ï¼š
   - å…¨éƒ¨
   - å…¨å±€çŸ¥è¯†åº“ (visibility=global)
   - ç»„ç»‡çŸ¥è¯†åº“ (visibility=org, å½“å‰ç»„ç»‡)
   - æˆ‘çš„çŸ¥è¯†åº“ (visibility=private)
3. ä¿ç•™ç°æœ‰å…±äº«ç©ºé—´å…¥å£ï¼ˆå…¼å®¹ï¼‰
```

#### 8.3.8 `frontend/src/views/knowledge/KnowledgeBaseEditorModal.vue` â€”â€” åˆ›å»ºå¼¹çª—

```
æ”¹é€ è¦ç‚¹ï¼š
1. æ–°å¢ã€Œå¯è§æ€§ã€å•é€‰æ¡†ï¼šä¸ªäººç§æœ‰(private) / ç»„ç»‡å†…å¯è§(org) / å…¨å±€å¯è§(global)
2. é€‰æ‹©ã€Œç»„ç»‡å†…å¯è§ã€æ—¶æ˜¾ç¤º OrgTreeSelector é€‰æ‹©å½’å±ç»„ç»‡
3. ã€Œå…¨å±€å¯è§ã€ä»…è¶…ç®¡å¯é€‰
4. é»˜è®¤é€‰æ‹©ã€Œä¸ªäººç§æœ‰ã€
```

#### 8.3.9 `frontend/src/router/index.ts` â€”â€” è·¯ç”±æ–°å¢

```typescript
// åœ¨ /platform children ä¸­æ–°å¢ï¼š
{
  path: 'admin',
  component: () => import('@/views/admin/AdminLayout.vue'),
  meta: { requiresAuth: true, requiresSuperAdmin: true },
  children: [
    { path: 'org-tree', name: 'orgTreeManage',
      component: () => import('@/views/admin/OrgTreeManage.vue') },
    { path: 'members', name: 'memberManage',
      component: () => import('@/views/admin/MemberManage.vue') },
  ]
}

// è·¯ç”±å®ˆå«å¢å¼º
router.beforeEach(async (to, from, next) => {
  // ... ç°æœ‰è®¤è¯æ£€æŸ¥ ...
  if (to.meta.requiresSuperAdmin && !authStore.isSuperAdmin) {
    next({ name: 'knowledgeBaseList' })
    return
  }
  next()
})
```

### 8.4 æ–‡ä»¶æ¸…å•æ±‡æ€»

| ç±»å‹ | æ–‡ä»¶è·¯å¾„ | æ“ä½œ | è¯´æ˜ |
|------|---------|------|------|
| **API** | `src/api/org-tree/index.ts` | æ–°å¢ | ç»„ç»‡æ ‘ç®¡ç† API |
| **API** | `src/api/organization/index.ts` | ä¿®æ”¹ | æ–°å¢ `getMyOrganizations()` |
| **API** | `src/api/knowledge-base/index.ts` | ä¿®æ”¹ | æ–°å¢ visibility + current_org_id å‚æ•° |
| **Store** | `src/stores/orgTree.ts` | æ–°å¢ | ç»„ç»‡æ ‘çŠ¶æ€ç®¡ç† |
| **Store** | `src/stores/auth.ts` | ä¿®æ”¹ | æ–°å¢ `isSuperAdmin` |
| **Store** | `src/stores/organization.ts` | ä¿®æ”¹ | æ–°å¢ `currentOrganizationId` + åˆ‡æ¢é€»è¾‘ |
| **Store** | `src/stores/menu.ts` | ä¿®æ”¹ | è¶…ç®¡èœå•é¡¹ |
| **ç»„ä»¶** | `src/components/OrganizationSwitcher.vue` | æ–°å¢ | ç»„ç»‡åˆ‡æ¢ä¸‹æ‹‰ |
| **ç»„ä»¶** | `src/components/OrgTreeSelector.vue` | æ–°å¢ | åˆ›å»º KB æ—¶é€‰æ‹©å½’å±ç»„ç»‡ |
| **ç»„ä»¶** | `src/components/menu.vue` | ä¿®æ”¹ | åŠ å…¥ OrganizationSwitcher + è¶…ç®¡å…¥å£ |
| **ç»„ä»¶** | `src/components/UserMenu.vue` | ä¿®æ”¹ | å¿«æ·è®¾ç½®æŒ‰è§’è‰²è¿‡æ»¤ |
| **ç»„ä»¶** | `src/components/ListSpaceSidebar.vue` | ä¿®æ”¹ | æŒ‰å¯è§æ€§åˆ†ç»„æ˜¾ç¤º |
| **é¡µé¢** | `src/views/admin/AdminLayout.vue` | æ–°å¢ | è¶…ç®¡é¡µé¢å¸ƒå±€ |
| **é¡µé¢** | `src/views/admin/OrgTreeManage.vue` | æ–°å¢ | ç»„ç»‡æ ‘ç®¡ç† |
| **é¡µé¢** | `src/views/admin/MemberManage.vue` | æ–°å¢ | äººå‘˜ç®¡ç† |
| **é¡µé¢** | `src/views/admin/components/OrgTreeEditor.vue` | æ–°å¢ | æ ‘å½¢ç¼–è¾‘å™¨ |
| **é¡µé¢** | `src/views/admin/components/MemberTable.vue` | æ–°å¢ | äººå‘˜è¡¨æ ¼ |
| **é¡µé¢** | `src/views/admin/components/AssignOrgDialog.vue` | æ–°å¢ | åˆ†é…ç»„ç»‡å¼¹çª— |
| **é¡µé¢** | `src/views/settings/Settings.vue` | ä¿®æ”¹ | navItems æŒ‰è§’è‰²è¿‡æ»¤ |
| **é¡µé¢** | `src/views/knowledge/KnowledgeBaseList.vue` | ä¿®æ”¹ | ä¼  current_org_id + å¯è§æ€§åˆ†ç»„ |
| **é¡µé¢** | `src/views/knowledge/KnowledgeBaseEditorModal.vue` | ä¿®æ”¹ | æ–°å¢ visibility é€‰æ‹© |
| **è·¯ç”±** | `src/router/index.ts` | ä¿®æ”¹ | admin è·¯ç”± + è¶…ç®¡å®ˆå« |
| **å›½é™…åŒ–** | `src/i18n/locales/zh-CN.ts` | ä¿®æ”¹ | æ–°å¢ç¿»è¯‘é”® |
| **å›½é™…åŒ–** | `src/i18n/locales/en.ts` | ä¿®æ”¹ | æ–°å¢ç¿»è¯‘é”® |

**æ–°å¢æ–‡ä»¶ 11 ä¸ªï¼Œä¿®æ”¹æ–‡ä»¶ 13 ä¸ªã€‚**

---

## 9. è¯¦ç»†å¼€å‘è®¡åˆ’

### å…¨å±€ä¾èµ–å…³ç³»å›¾

```
Sprint 1ï¼ˆåŸºç¡€å±‚ï¼‰
  T1.1 è¿ç§»è„šæœ¬ â”€â”€â†’ T1.2 Go ç±»å‹ â”€â”€â†’ T1.3 æ¥å£å®šä¹‰
                            â”‚
Sprint 2ï¼ˆåç«¯æƒé™ï¼‰          â†“
  T2.1 è¶…ç®¡ä¸­é—´ä»¶ â”€â”€â†’ T2.2 è·¯ç”±æ‹†åˆ† â”€â”€â†’ T2.3 Auth /me æ”¹é€ 
                                              â”‚
Sprint 3ï¼ˆåç«¯ç»„ç»‡æ ‘ï¼‰                          â†“
  T3.1 Org Repository â”€â”€â†’ T3.2 OrgTreeService â”€â”€â†’ T3.3 OrgTreeHandler â”€â”€â†’ T3.4 è·¯ç”±æ³¨å†Œ+DI
                                                                              â”‚
Sprint 4ï¼ˆåç«¯KBå¯è§æ€§ï¼‰                                                       â†“
  T4.1 KB Repository â”€â”€â†’ T4.2 KBVisibilityService â”€â”€â†’ T4.3 KB Handleræ”¹é€  â”€â”€â†’ T4.4 my-organizations API
                                                                                    â”‚
Sprint 5ï¼ˆå‰ç«¯åŸºç¡€è®¾æ–½ï¼‰           â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  T5.1 auth store â”€â”€â†’ T5.2 org store â”€â”€â†’ T5.3 org-tree API+Store
         â”‚
Sprint 6ï¼ˆå‰ç«¯æƒé™æ§åˆ¶ï¼‰
  T6.1 Settingsè¿‡æ»¤ â”€â”€â†’ T6.2 UserMenuè¿‡æ»¤ â”€â”€â†’ T6.3 è·¯ç”±å®ˆå«
         â”‚
Sprint 7ï¼ˆå‰ç«¯è¶…ç®¡é¡µé¢ï¼‰
  T7.1 AdminLayout â”€â”€â†’ T7.2 OrgTreeManage â”€â”€â†’ T7.3 MemberManage â”€â”€â†’ T7.4 èœå•æ”¹é€ 
                                                                          â”‚
Sprint 8ï¼ˆå‰ç«¯ç»„ç»‡åˆ‡æ¢+KBæ”¹é€ ï¼‰                                              â†“
  T8.1 OrganizationSwitcher â”€â”€â†’ T8.2 KB APIæ”¹é€  â”€â”€â†’ T8.3 KBListæ”¹é€  â”€â”€â†’ T8.4 KBåˆ›å»ºæ”¹é€ 
                                                                              â”‚
Sprint 9ï¼ˆæ”¶å°¾ï¼‰                                                               â†“
  T9.1 å›½é™…åŒ– â”€â”€â†’ T9.2 è”è°ƒ â”€â”€â†’ T9.3 å›å½’æµ‹è¯•
```

---

### Sprint 1ï¼šæ•°æ®åº“ + ç±»å‹å®šä¹‰ï¼ˆ2 å¤©ï¼‰

#### T1.1 ç¼–å†™æ•°æ®åº“è¿ç§»è„šæœ¬

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `migrations/versioned/000013_org_tree_kb_visibility.up.sql` |
| | `migrations/versioned/000013_org_tree_kb_visibility.down.sql` |
| **å·¥ä½œå†…å®¹** | â‘  `organizations` åŠ  `parent_id`, `path`, `level`, `sort_order`, `tenant_id` äº”ä¸ªå­—æ®µ + ç´¢å¼• + è‡ªå¼•ç”¨å¤–é”® |
| | â‘¡ `users` åŠ  `is_super_admin` å­—æ®µï¼Œåˆå§‹å°† `can_access_all_tenants=true` çš„ç”¨æˆ·è®¾ä¸ºè¶…ç®¡ |
| | â‘¢ `knowledge_bases` åŠ  `created_by`, `visibility`, `organization_id` ä¸‰ä¸ªå­—æ®µ + ç´¢å¼• |
| | â‘£ ç°æœ‰ç»„ç»‡ `path` å›å¡«ä¸º `'/' \|\| id`ï¼Œ`level` è®¾ä¸º 1 |
| | â‘¤ ç¼–å†™å¯¹åº” down å›æ»šè„šæœ¬ |
| **ä¾èµ–** | æ—  |
| **éªŒæ”¶æ ‡å‡†** | åœ¨å¼€å‘ç¯å¢ƒæ‰§è¡Œ `up.sql` æˆåŠŸï¼Œæ‰§è¡Œ `down.sql` å¯å®Œæ•´å›æ»šï¼Œç°æœ‰æ•°æ®ä¸ä¸¢å¤± |
| **é¢„è®¡è€—æ—¶** | 0.5 å¤© |

#### T1.2 ä¿®æ”¹ Go ç±»å‹å®šä¹‰

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `internal/types/organization.go` |
| | `internal/types/user.go` |
| | `internal/types/knowledgebase.go` |
| **å·¥ä½œå†…å®¹** | â‘  `Organization` ç»“æ„ä½“åŠ  `ParentID *string`, `Path string`, `Level int`, `SortOrder int`, `TenantID uint64`, `Children []*Organization`ï¼ˆgorm:"-"ï¼‰|
| | â‘¡ æ–°å¢ `CreateOrgTreeNodeRequest`, `MoveOrgNodeRequest`, `OrgTreeNode`, `AssignUserRequest` è¯·æ±‚ç±»å‹ |
| | â‘¢ `User` ç»“æ„ä½“åŠ  `IsSuperAdmin bool`ï¼Œæ›´æ–° `ToUserInfo()` æ–¹æ³• |
| | â‘£ `KnowledgeBase` ç»“æ„ä½“åŠ  `CreatedBy string`, `Visibility string`, `OrganizationID string` |
| | â‘¤ æ–°å¢ `KBVisibilityGlobal`/`KBVisibilityOrg`/`KBVisibilityPrivate` å¸¸é‡ |
| **ä¾èµ–** | T1.1ï¼ˆç±»å‹éœ€åŒ¹é…æ•°æ®åº“å­—æ®µï¼‰ |
| **éªŒæ”¶æ ‡å‡†** | `go build ./...` ç¼–è¯‘é€šè¿‡ï¼ŒGORM AutoMigrate ä¸ SQL è¿ç§»å­—æ®µä¸€è‡´ |
| **é¢„è®¡è€—æ—¶** | 0.5 å¤© |

#### T1.3 å®šä¹‰ Service æ¥å£

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | æ–°å»º `internal/types/interfaces/org_tree.go` |
| | æ–°å»º `internal/types/interfaces/kb_visibility.go` |
| **å·¥ä½œå†…å®¹** | â‘  å®šä¹‰ `OrgTreeService` æ¥å£ï¼ˆCreateNode, UpdateNode, DeleteNode, MoveNode, GetTree, GetOrgAndDescendantIDs, GetOrgAndAncestorIDs, AssignUserToOrg, RemoveUserFromOrg, SetOrgAdmin, GetUserOrganizationsï¼‰|
| | â‘¡ å®šä¹‰ `KBVisibilityService` æ¥å£ï¼ˆListAccessibleKBs, CanAccessKB, CanManageKBï¼‰|
| | â‘¢ åœ¨ç°æœ‰ `OrganizationRepository` æ¥å£ä¸­æ–°å¢æ–¹æ³•ç­¾åï¼ˆGetByIDAndTenant, ListByTenantID, GetChildren, GetByPath, UpdatePath, GetByIDsï¼‰|
| | â‘£ åœ¨ç°æœ‰ `KnowledgeBaseRepository` æ¥å£ä¸­æ–°å¢æ–¹æ³•ç­¾åï¼ˆListAccessibleKBs, ListKBsByOrganizationï¼‰|
| **ä¾èµ–** | T1.2 |
| **éªŒæ”¶æ ‡å‡†** | `go build ./...` ç¼–è¯‘é€šè¿‡ï¼ˆå®ç°å‡ä¸ºç©ºï¼‰ |
| **é¢„è®¡è€—æ—¶** | 0.5 å¤© |

---

### Sprint 2ï¼šåç«¯è¶…ç®¡ä¸­é—´ä»¶ + è·¯ç”±æ‹†åˆ†ï¼ˆ2 å¤©ï¼‰

#### T2.1 å®ç° RequireSuperAdmin ä¸­é—´ä»¶

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | æ–°å»º `internal/middleware/super_admin.go` |
| **å·¥ä½œå†…å®¹** | â‘  ä» gin.Context è·å– Userï¼Œæ£€æŸ¥ `IsSuperAdmin` |
| | â‘¡ æœªè®¤è¯è¿”å› 401ï¼Œéè¶…ç®¡è¿”å› 403 |
| | â‘¢ ç¼–å†™å•å…ƒæµ‹è¯• `super_admin_test.go` |
| **ä¾èµ–** | T1.2ï¼ˆUser ç±»å‹å·²æœ‰ IsSuperAdminï¼‰ |
| **éªŒæ”¶æ ‡å‡†** | ä¸­é—´ä»¶æµ‹è¯•ç”¨ä¾‹è¦†ç›–ï¼šè¶…ç®¡é€šè¿‡ã€éè¶…ç®¡è¢«æ‹’ã€æœªè®¤è¯è¢«æ‹’ |
| **é¢„è®¡è€—æ—¶** | 0.5 å¤© |

#### T2.2 è·¯ç”±æ‹†åˆ†â€”â€”è¶…ç®¡ API ä¸æ™®é€š API åˆ†ç»„

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `internal/router/router.go` |
| **å·¥ä½œå†…å®¹** | â‘  æ–°å»º `superAdmin := v1.Group("", middleware.RequireSuperAdmin())` è·¯ç”±ç»„ |
| | â‘¡ å°† `POST/PUT/DELETE /models/*` ä»åŸè·¯ç”±ç»„ç§»å…¥ superAdmin ç»„ |
| | â‘¢ å°† `GET /system/info`, `GET /system/minio/buckets` ç§»å…¥ superAdmin ç»„ |
| | â‘£ å°† `PUT /tenants/kv/:key` ç§»å…¥ superAdmin ç»„ |
| | â‘¤ ä¿ç•™ `GET /models`, `GET /models/:id`, `GET /tenants/kv/:key` åœ¨åŸè·¯ç”±ç»„ |
| | â‘¥ é¢„ç•™ `/org-tree` è·¯ç”±ç»„ï¼ˆHandler æš‚ä¸æ³¨å†Œï¼Œé¿å…ç¼–è¯‘é”™è¯¯ï¼‰ |
| **ä¾èµ–** | T2.1 |
| **éªŒæ”¶æ ‡å‡†** | `go build` é€šè¿‡ï¼ŒåŸæœ‰ API åŠŸèƒ½ä¸å—å½±å“ï¼Œè¶…ç®¡ API éè¶…ç®¡è°ƒç”¨è¿”å› 403 |
| **é¢„è®¡è€—æ—¶** | 0.5 å¤© |

#### T2.3 Auth /me æ¥å£æ”¹é€ 

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `internal/handler/auth.go`ï¼ˆæˆ–å¯¹åº”çš„ GetCurrentUser handlerï¼‰ |
| **å·¥ä½œå†…å®¹** | â‘  ç¡®ä¿ `/api/v1/auth/me` è¿”å›çš„ UserInfo åŒ…å« `is_super_admin` å­—æ®µ |
| | â‘¡ è‹¥ UserInfo ç”± `User.ToUserInfo()` æ„å»ºï¼Œç¡®è®¤ T1.2 ä¸­å·²åŒ…å«è¯¥å­—æ®µ |
| **ä¾èµ–** | T1.2 |
| **éªŒæ”¶æ ‡å‡†** | è°ƒç”¨ `/auth/me` å“åº” JSON ä¸­æœ‰ `is_super_admin: true/false` |
| **é¢„è®¡è€—æ—¶** | 0.5 å¤© |

> **Sprint 2 æ£€æŸ¥ç‚¹**ï¼šæ­¤æ—¶åç«¯å·²å…·å¤‡è¶…ç®¡æƒé™æ§åˆ¶èƒ½åŠ›â€”â€”è¶…ç®¡ API å—ä¿æŠ¤ï¼Œ/me è¿”å›è§’è‰²ä¿¡æ¯ï¼Œå¯ç‹¬ç«‹éƒ¨ç½²éªŒè¯ã€‚

---

### Sprint 3ï¼šåç«¯ç»„ç»‡æ ‘åŠŸèƒ½ï¼ˆ3 å¤©ï¼‰

#### T3.1 Organization Repository å±‚æ‰©å±•

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `internal/application/repository/organization.go` |
| **å·¥ä½œå†…å®¹** | â‘  å®ç° `GetByIDAndTenant(tenantID, orgID)` |
| | â‘¡ å®ç° `ListByTenantID(tenantID)` â€”â€” æŸ¥è¯¢ç§Ÿæˆ·ä¸‹æ‰€æœ‰ç»„ç»‡ |
| | â‘¢ å®ç° `GetChildren(tenantID, parentID)` â€”â€” æŸ¥è¯¢ç›´æ¥å­ç»„ç»‡ |
| | â‘£ å®ç° `GetByPath(tenantID, pathPrefix)` â€”â€” å‰ç¼€åŒ¹é…æŸ¥è¯¢å­æ ‘ |
| | â‘¤ å®ç° `UpdatePath(orgID, path, level)` â€”â€” æ›´æ–°ç‰©åŒ–è·¯å¾„ |
| | â‘¥ å®ç° `GetByIDs(orgIDs []string)` â€”â€” æ‰¹é‡æŸ¥è¯¢ |
| | â‘¦ å®ç° `ListMembersByUserID(userID)` â€”â€” æŸ¥è¯¢ç”¨æˆ·æ‰€å±çš„æ‰€æœ‰ç»„ç»‡æˆå‘˜å…³ç³» |
| **ä¾èµ–** | T1.3 |
| **éªŒæ”¶æ ‡å‡†** | å„æ–¹æ³•ç¼–è¯‘é€šè¿‡ï¼Œå¯é…åˆæ•°æ®åº“åšé›†æˆæµ‹è¯• |
| **é¢„è®¡è€—æ—¶** | 1 å¤© |

#### T3.2 OrgTreeService å®ç°

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | æ–°å»º `internal/application/service/org_tree.go` |
| **å·¥ä½œå†…å®¹** | â‘  `CreateNode` â€”â€” åˆ›å»ºç»„ç»‡èŠ‚ç‚¹ï¼Œè®¡ç®— pathï¼ˆparent.path + "/" + self.idï¼‰å’Œ level |
| | â‘¡ `UpdateNode` â€”â€” æ›´æ–°åç§°/æè¿°/æ’åº |
| | â‘¢ `DeleteNode` â€”â€” åˆ é™¤èŠ‚ç‚¹ï¼ˆå­èŠ‚ç‚¹ parent_id ç½® NULL æˆ–çº§è”å¤„ç†ï¼‰ |
| | â‘£ `MoveNode` â€”â€” ç§»åŠ¨èŠ‚ç‚¹åˆ°æ–°çˆ¶çº§ï¼Œé€’å½’æ›´æ–°æ‰€æœ‰åä»£ path å’Œ level |
| | â‘¤ `GetTree` â€”â€” æŸ¥è¯¢æ‰€æœ‰ç»„ç»‡å¹¶ç»„è£…ä¸ºæ ‘å½¢ç»“æ„ï¼ˆå†…å­˜æ„å»ºï¼‰ |
| | â‘¥ `GetOrgAndDescendantIDs` â€”â€” åˆ©ç”¨ path å‰ç¼€æŸ¥è¯¢åä»£ |
| | â‘¦ `GetOrgAndAncestorIDs` â€”â€” ä» path æ‹†è§£è·å–ç¥–å…ˆ ID |
| | â‘§ `AssignUserToOrg` â€”â€” åˆ›å»º organization_member è®°å½• |
| | â‘¨ `RemoveUserFromOrg` â€”â€” åˆ é™¤ organization_member è®°å½• |
| | â‘© `SetOrgAdmin` â€”â€” æ›´æ–°æˆå‘˜è§’è‰²ä¸º admin |
| | â‘ª `GetUserOrganizations` â€”â€” æŸ¥è¯¢ç”¨æˆ·æ‰€å±ç»„ç»‡åˆ—è¡¨ |
| **ä¾èµ–** | T3.1 |
| **éªŒæ”¶æ ‡å‡†** | å•å…ƒæµ‹è¯•è¦†ç›–ï¼šåˆ›å»º/ç§»åŠ¨/åˆ é™¤èŠ‚ç‚¹çš„ path/level è®¡ç®—æ­£ç¡®ï¼Œæ ‘å½¢æ„å»ºæ­£ç¡® |
| **é¢„è®¡è€—æ—¶** | 1.5 å¤© |

#### T3.3 OrgTreeHandler å®ç°

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | æ–°å»º `internal/handler/org_tree.go` |
| **å·¥ä½œå†…å®¹** | â‘  `GetOrgTree` â€”â€” GET /org-tree |
| | â‘¡ `CreateOrgNode` â€”â€” POST /org-tree |
| | â‘¢ `UpdateOrgNode` â€”â€” PUT /org-tree/:id |
| | â‘£ `DeleteOrgNode` â€”â€” DELETE /org-tree/:id |
| | â‘¤ `MoveOrgNode` â€”â€” PUT /org-tree/:id/move |
| | â‘¥ `AssignUser` â€”â€” POST /org-tree/:id/users |
| | â‘¦ `RemoveUser` â€”â€” DELETE /org-tree/:id/users/:user_id |
| | â‘§ `SetOrgAdmin` â€”â€” PUT /org-tree/:id/admin |
| | æ¯ä¸ªæ–¹æ³•ï¼šå‚æ•°ç»‘å®š â†’ æƒé™æ ¡éªŒï¼ˆtenantIDï¼‰ â†’ è°ƒç”¨ Service â†’ è¿”å›ç»“æœ |
| **ä¾èµ–** | T3.2 |
| **éªŒæ”¶æ ‡å‡†** | ä½¿ç”¨ curl/Postman æµ‹è¯•å…¨éƒ¨ 8 ä¸ªæ¥å£æ­£å¸¸å·¥ä½œ |
| **é¢„è®¡è€—æ—¶** | 1 å¤© |

#### T3.4 è·¯ç”±æ³¨å†Œ + DI å®¹å™¨

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `internal/router/router.go`, `internal/container/container.go` |
| **å·¥ä½œå†…å®¹** | â‘  `container.go` æ–°å¢ `Provide(service.NewOrgTreeService)`, `Provide(handler.NewOrgTreeHandler)` |
| | â‘¡ `router.go` å°† T2.2 é¢„ç•™çš„ `/org-tree` è·¯ç”±ç»„ç»‘å®šåˆ° OrgTreeHandler çš„æ–¹æ³• |
| | â‘¢ æ–°å¢ `GET /my-organizations` è·¯ç”±ï¼ˆæ™®é€šç”¨æˆ·ç»„ï¼‰â€”â€”è°ƒç”¨ OrgTreeService.GetUserOrganizations |
| **ä¾èµ–** | T3.3 |
| **éªŒæ”¶æ ‡å‡†** | æœåŠ¡å¯åŠ¨æ— æŠ¥é”™ï¼Œ`GET /org-tree` è¿”å›ç©ºæ•°ç»„ï¼Œ`POST /org-tree` å¯åˆ›å»ºèŠ‚ç‚¹ |
| **é¢„è®¡è€—æ—¶** | 0.5 å¤© |

> **Sprint 3 æ£€æŸ¥ç‚¹**ï¼šç»„ç»‡æ ‘ CRUD + æˆå‘˜ç®¡ç† + æˆ‘çš„ç»„ç»‡åˆ—è¡¨ API å®Œæ•´å¯ç”¨ï¼Œå¯ç”¨ Postman ç«¯åˆ°ç«¯æµ‹è¯•ã€‚

---

### Sprint 4ï¼šåç«¯çŸ¥è¯†åº“å¯è§æ€§ï¼ˆ2 å¤©ï¼‰

#### T4.1 KnowledgeBase Repository æ‰©å±•

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `internal/application/repository/knowledgebase.go` |
| **å·¥ä½œå†…å®¹** | â‘  å®ç° `ListAccessibleKBs(tenantID, userID, relatedOrgIDs, isSuperAdmin)` |
| | æ ¸å¿ƒ SQLï¼š`WHERE tenant_id=? AND is_temporary=false AND (visibility='global' OR (visibility='org' AND organization_id IN (?)) OR (visibility='private' AND created_by=?))` |
| | â‘¡ å®ç° `ListKBsByOrganization(tenantID, orgID)` â€”â€” æŸ¥è¯¢å½’å±ç‰¹å®šç»„ç»‡çš„ KB |
| **ä¾èµ–** | T1.3 |
| **éªŒæ”¶æ ‡å‡†** | è¶…ç®¡æŸ¥å…¨éƒ¨ï¼Œæ™®é€šç”¨æˆ·æŒ‰å¯è§æ€§è¿‡æ»¤ï¼ŒSQL æ‰§è¡Œè®¡åˆ’èµ°ç´¢å¼• |
| **é¢„è®¡è€—æ—¶** | 0.5 å¤© |

#### T4.2 KBVisibilityService å®ç°

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | æ–°å»º `internal/application/service/kb_visibility.go` |
| **å·¥ä½œå†…å®¹** | â‘  `ListAccessibleKBs(tenantID, userID, currentOrgID)` â€”â€” è·å–å…³è”ç»„ç»‡ ID â†’ è°ƒç”¨ Repository |
| | â‘¡ `CanAccessKB(tenantID, userID, currentOrgID, kb)` â€”â€” å•æ¡ KB è®¿é—®æƒé™åˆ¤å®š |
| | â‘¢ `CanManageKB(tenantID, userID, kb)` â€”â€” ç¼–è¾‘/åˆ é™¤æƒé™ï¼ˆè¶…ç®¡ \|\| åˆ›å»ºè€… \|\| ç»„ç»‡adminï¼‰ |
| **ä¾èµ–** | T4.1, T3.2ï¼ˆä¾èµ– OrgTreeService è·å–ç»„ç»‡è·¯å¾„ï¼‰ |
| **éªŒæ”¶æ ‡å‡†** | è¦†ç›–æµ‹è¯•ï¼šè¶…ç®¡å…¨éƒ¨å¯è§ã€global å…¨å‘˜å¯è§ã€org ä»…å…³è”ç»„ç»‡å¯è§ã€private ä»…åˆ›å»ºè€…å¯è§ |
| **é¢„è®¡è€—æ—¶** | 0.5 å¤© |

#### T4.3 KnowledgeBase Handler æ”¹é€ 

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `internal/handler/knowledgebase.go` |
| **å·¥ä½œå†…å®¹** | â‘  `ListKnowledgeBases` æ”¹é€ ï¼šå¢åŠ  `current_org_id` æŸ¥è¯¢å‚æ•°ï¼Œè°ƒç”¨ `KBVisibilityService.ListAccessibleKBs` æ›¿æ¢åŸç›´æ¥æŸ¥è¯¢ |
| | â‘¡ `CreateKnowledgeBase` æ”¹é€ ï¼šè®¾ç½® `created_by = user.ID`ï¼ŒæŒ‰ visibility å€¼éªŒè¯æƒé™ï¼ˆglobal éœ€è¶…ç®¡ï¼Œorg éœ€ admin/editor ä¸”å¿…é¡»æœ‰ organization_idï¼Œprivate æ— é™åˆ¶ï¼‰ |
| | â‘¢ `UpdateKnowledgeBase` / `DeleteKnowledgeBase` æ”¹é€ ï¼šè°ƒç”¨ `CanManageKB` æ ¡éªŒ |
| **ä¾èµ–** | T4.2 |
| **éªŒæ”¶æ ‡å‡†** | åˆ›å»ºä¸åŒ visibility çš„ KB â†’ ä»¥ä¸åŒè§’è‰²ç”¨æˆ·æŸ¥çœ‹åˆ—è¡¨ â†’ éªŒè¯å¯è§æ€§è§„åˆ™æ­£ç¡® |
| **é¢„è®¡è€—æ—¶** | 0.5 å¤© |

#### T4.4 KnowledgeBase Service æ”¹é€  + DI æ³¨å†Œ

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `internal/application/service/knowledgebase.go`, `internal/container/container.go` |
| **å·¥ä½œå†…å®¹** | â‘  `CreateKnowledgeBase` ä¸­è®¾ç½® `kb.CreatedBy`ï¼ˆä» context å– UserIDï¼‰å’Œé»˜è®¤ `Visibility` |
| | â‘¡ `container.go` æ–°å¢ `Provide(service.NewKBVisibilityService)` |
| | â‘¢ æ›´æ–° `KnowledgeBaseHandler` ä¾èµ–æ³¨å…¥ï¼Œæ–°å¢ `kbVisibilityService` å‚æ•° |
| **ä¾èµ–** | T4.3 |
| **éªŒæ”¶æ ‡å‡†** | æœåŠ¡å¯åŠ¨æ— æŠ¥é”™ï¼Œå…¨æµç¨‹ API å·¥ä½œæ­£å¸¸ |
| **é¢„è®¡è€—æ—¶** | 0.5 å¤© |

> **Sprint 4 æ£€æŸ¥ç‚¹**ï¼šåç«¯å…¨éƒ¨å®Œæˆâ€”â€”ç»„ç»‡æ ‘ + è¶…ç®¡æƒé™ + KB å¯è§æ€§ã€‚å¯è¿›è¡Œåç«¯å®Œæ•´é›†æˆæµ‹è¯•ã€‚

---

### Sprint 5ï¼šå‰ç«¯åŸºç¡€è®¾æ–½ï¼ˆ1 å¤©ï¼‰

#### T5.1 auth store æ‰©å±•

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `frontend/src/stores/auth.ts` |
| **å·¥ä½œå†…å®¹** | â‘  åœ¨ UserInfo ç±»å‹ä¸­æ–°å¢ `is_super_admin: boolean` |
| | â‘¡ æ–°å¢ `isSuperAdmin` computed å±æ€§ |
| | â‘¢ ç¡®ä¿ `fetchProfile()` / login åè§£ææ–°å­—æ®µ |
| **ä¾èµ–** | T2.3ï¼ˆåç«¯ /me å·²è¿”å› is_super_adminï¼‰ |
| **éªŒæ”¶æ ‡å‡†** | ç™»å½•å `authStore.isSuperAdmin` å€¼ä¸åç«¯ä¸€è‡´ |
| **é¢„è®¡è€—æ—¶** | 2h |

#### T5.2 organization store æ‰©å±•

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `frontend/src/stores/organization.ts`, `frontend/src/api/organization/index.ts` |
| **å·¥ä½œå†…å®¹** | â‘  API å±‚æ–°å¢ `getMyOrganizations()` â€”â€” GET /my-organizations |
| | â‘¡ Store æ–°å¢ `currentOrganizationId` refï¼ˆlocalStorage æŒä¹…åŒ–ï¼‰ |
| | â‘¢ Store æ–°å¢ `myOrganizationList` ref |
| | â‘£ Store æ–°å¢ `currentOrganization` computed |
| | â‘¤ Store æ–°å¢ `switchOrganization(orgId)` æ–¹æ³• |
| | â‘¥ Store æ–°å¢ `fetchMyOrganizations()` æ–¹æ³• + åˆå§‹åŒ–é€»è¾‘ |
| **ä¾èµ–** | T3.4ï¼ˆåç«¯ /my-organizations å·²å¯ç”¨ï¼‰ |
| **éªŒæ”¶æ ‡å‡†** | ç™»å½•åæ§åˆ¶å°æŸ¥çœ‹ `orgStore.myOrganizationList` æœ‰æ•°æ®ï¼Œåˆ‡æ¢å `currentOrganizationId` å˜åŒ– |
| **é¢„è®¡è€—æ—¶** | 3h |

#### T5.3 org-tree API + Store

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | æ–°å»º `frontend/src/api/org-tree/index.ts`, æ–°å»º `frontend/src/stores/orgTree.ts` |
| **å·¥ä½œå†…å®¹** | â‘  API æ–‡ä»¶ï¼šå®šä¹‰ OrgTreeNode æ¥å£ + 8 ä¸ª API æ–¹æ³•ï¼ˆCRUD + æˆå‘˜ç®¡ç†ï¼‰ |
| | â‘¡ Storeï¼štree ref, loading ref, fetchTree/createNode/updateNode/deleteNode/moveNode æ–¹æ³• |
| **ä¾èµ–** | T3.4ï¼ˆåç«¯ /org-tree API å·²å¯ç”¨ï¼‰ |
| **éªŒæ”¶æ ‡å‡†** | æ§åˆ¶å°æ‰‹åŠ¨è°ƒç”¨ `orgTreeStore.fetchTree()` è¿”å›ç»„ç»‡æ ‘æ•°æ® |
| **é¢„è®¡è€—æ—¶** | 2h |

---

### Sprint 6ï¼šå‰ç«¯æƒé™æ§åˆ¶ï¼ˆ1.5 å¤©ï¼‰

#### T6.1 Settings å¼¹çª—æŒ‰è§’è‰²è¿‡æ»¤

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `frontend/src/views/settings/Settings.vue` |
| **å·¥ä½œå†…å®¹** | â‘  å¯¼å…¥ `useAuthStore` |
| | â‘¡ ä¸º `navItems` æ•°ç»„æ¯é¡¹æ·»åŠ  `superAdminOnly` å±æ€§ |
| | â‘¢ å°† `navItems` ä» `computed` æ”¹ä¸ºå¸¦è¿‡æ»¤çš„ computedï¼š`allNavItems.filter(item => !item.superAdminOnly \|\| authStore.isSuperAdmin)` |
| | â‘£ è¶…ç®¡ä¸“å±é¡¹ï¼šmodels, ollama, websearch, mcp, system, tenant |
| | â‘¤ éè¶…ç®¡ç”¨æˆ·æ‰“å¼€ Settings é»˜è®¤å±•ç¤º "å¸¸è§„è®¾ç½®"ï¼Œä¸å†æ˜¾ç¤ºå—é™é¡¹ |
| **ä¾èµ–** | T5.1 |
| **éªŒæ”¶æ ‡å‡†** | è¶…ç®¡æ‰“å¼€ Settings çœ‹åˆ°å…¨éƒ¨ 8 é¡¹ï¼Œæ™®é€šç”¨æˆ·åªçœ‹åˆ° "å¸¸è§„è®¾ç½®" + "API ä¿¡æ¯" 2 é¡¹ |
| **é¢„è®¡è€—æ—¶** | 3h |

#### T6.2 UserMenu å¿«æ·å…¥å£è¿‡æ»¤

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `frontend/src/components/UserMenu.vue` |
| **å·¥ä½œå†…å®¹** | â‘  å¯¼å…¥ `useAuthStore` |
| | â‘¡ å¿«æ·è®¾ç½®å…¥å£ï¼ˆmodels/ollama/websearch/mcpï¼‰ä»…åœ¨ `isSuperAdmin` æ—¶æ˜¾ç¤º |
| | â‘¢ éè¶…ç®¡åªæ˜¾ç¤º "å¸¸è§„è®¾ç½®" å¿«æ·å…¥å£ |
| **ä¾èµ–** | T5.1 |
| **éªŒæ”¶æ ‡å‡†** | éè¶…ç®¡ç‚¹å‡»å¤´åƒèœå•ï¼Œä¸å‡ºç° "æ¨¡å‹ç®¡ç†" ç­‰å¿«æ·å…¥å£ |
| **é¢„è®¡è€—æ—¶** | 2h |

#### T6.3 è·¯ç”±å®ˆå« + admin è·¯ç”±å®šä¹‰

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `frontend/src/router/index.ts` |
| **å·¥ä½œå†…å®¹** | â‘  åœ¨ `/platform` children ä¸­æ–°å¢ `admin` åµŒå¥—è·¯ç”±ï¼ˆå­è·¯ç”± org-tree, membersï¼‰ï¼Œè®¾ç½® `meta: { requiresSuperAdmin: true }` |
| | â‘¡ `router.beforeEach` ä¸­æ–°å¢åˆ¤æ–­ï¼š`to.meta.requiresSuperAdmin && !authStore.isSuperAdmin` æ—¶é‡å®šå‘åˆ°çŸ¥è¯†åº“åˆ—è¡¨ |
| | â‘¢ æ‡’åŠ è½½ AdminLayout / OrgTreeManage / MemberManage ç»„ä»¶ï¼ˆæ­¤æ—¶ç»„ä»¶å¯ä¸ºéª¨æ¶å ä½ï¼‰ |
| **ä¾èµ–** | T5.1 |
| **éªŒæ”¶æ ‡å‡†** | æ™®é€šç”¨æˆ·è®¿é—® `/platform/admin/org-tree` è¢«é‡å®šå‘ï¼Œè¶…ç®¡æ­£å¸¸è¿›å…¥ |
| **é¢„è®¡è€—æ—¶** | 2h |

---

### Sprint 7ï¼šå‰ç«¯è¶…ç®¡é¡µé¢ï¼ˆ3 å¤©ï¼‰

#### T7.1 AdminLayout é¡µé¢æ¡†æ¶

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | æ–°å»º `frontend/src/views/admin/AdminLayout.vue` |
| **å·¥ä½œå†…å®¹** | â‘  å·¦ä¾§å­å¯¼èˆªï¼šç»„ç»‡ç®¡ç†ã€äººå‘˜ç®¡ç†ï¼ˆä½¿ç”¨ t-menuï¼‰ |
| | â‘¡ å³ä¾§å†…å®¹åŒºï¼šRouterView |
| | â‘¢ æ ·å¼ä¸ä¸»å¸ƒå±€ platform/index.vue ä¸€è‡´ |
| **ä¾èµ–** | T6.3ï¼ˆè·¯ç”±å·²å®šä¹‰ï¼‰ |
| **éªŒæ”¶æ ‡å‡†** | è¶…ç®¡è¿›å…¥ /platform/admin çœ‹åˆ°å·¦ä¾§å­å¯¼èˆª + ç©ºç™½å†…å®¹åŒº |
| **é¢„è®¡è€—æ—¶** | 3h |

#### T7.2 ç»„ç»‡æ ‘ç®¡ç†é¡µ OrgTreeManage

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | æ–°å»º `frontend/src/views/admin/OrgTreeManage.vue` |
| | æ–°å»º `frontend/src/views/admin/components/OrgTreeEditor.vue` |
| **å·¥ä½œå†…å®¹** | â‘  é¡µé¢é¡¶éƒ¨ï¼šæ ‡é¢˜ + "åˆ›å»ºé¡¶çº§ç»„ç»‡" æŒ‰é’® |
| | â‘¡ ä½¿ç”¨ TDesign `t-tree` ç»„ä»¶æ¸²æŸ“ç»„ç»‡æ ‘ï¼Œæ”¯æŒå±•å¼€/æŠ˜å  |
| | â‘¢ æ‹–æ‹½æ’åºï¼ˆdrag-end è°ƒç”¨ moveNodeï¼‰ |
| | â‘£ æ¯ä¸ªèŠ‚ç‚¹æ“ä½œï¼šç¼–è¾‘ï¼ˆå¼¹çª—ä¿®æ”¹åç§°/æè¿°ï¼‰ã€æ·»åŠ å­ç»„ç»‡ã€ç®¡ç†æˆå‘˜ï¼ˆè·³è½¬/å¼¹çª—ï¼‰ã€åˆ é™¤ï¼ˆç¡®è®¤ååˆ é™¤ï¼‰ |
| | â‘¤ OrgTreeEditor å­ç»„ä»¶ï¼šåˆ›å»º/ç¼–è¾‘ç»„ç»‡çš„è¡¨å•å¼¹çª— |
| | â‘¥ åŠ è½½çŠ¶æ€å’Œç©ºçŠ¶æ€å¤„ç† |
| **ä¾èµ–** | T7.1, T5.3 |
| **éªŒæ”¶æ ‡å‡†** | å¯åˆ›å»ºå¤šçº§ç»„ç»‡ã€æ‹–æ‹½ç§»åŠ¨ã€ç¼–è¾‘åˆ é™¤ï¼Œæ•°æ®å®æ—¶åŒæ­¥ |
| **é¢„è®¡è€—æ—¶** | 1 å¤© |

#### T7.3 äººå‘˜ç®¡ç†é¡µ MemberManage

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | æ–°å»º `frontend/src/views/admin/MemberManage.vue` |
| | æ–°å»º `frontend/src/views/admin/components/MemberTable.vue` |
| | æ–°å»º `frontend/src/views/admin/components/AssignOrgDialog.vue` |
| **å·¥ä½œå†…å®¹** | â‘  é¡µé¢å¸ƒå±€ï¼šæœç´¢æ  + äººå‘˜è¡¨æ ¼ |
| | â‘¡ MemberTableï¼šå±•ç¤ºç”¨æˆ·åˆ—è¡¨ï¼Œåˆ—åŒ…å«ç”¨æˆ·å/é‚®ç®±/æ‰€å±ç»„ç»‡ï¼ˆTag åˆ—è¡¨ï¼‰/æ˜¯å¦è¶…ç®¡/æ“ä½œ |
| | â‘¢ æ•°æ®æ¥æºï¼šè°ƒç”¨åç«¯ç”¨æˆ·åˆ—è¡¨ APIï¼ˆå¯èƒ½éœ€è¦åç«¯æ–°å¢ `GET /admin/users`ï¼Œæˆ–å¤ç”¨ç°æœ‰ç§Ÿæˆ·ç”¨æˆ·åˆ—è¡¨ï¼‰ |
| | â‘£ AssignOrgDialogï¼šé€‰æ‹©ç»„ç»‡ï¼ˆOrgTreeSelectorï¼‰+ é€‰æ‹©è§’è‰² â†’ è°ƒç”¨ assignUserToOrg |
| | â‘¤ æ“ä½œï¼šåˆ†é…ç»„ç»‡ã€ä»ç»„ç»‡ç§»é™¤ã€è®¾ä¸ºè¶…ç®¡ |
| **ä¾èµ–** | T7.1, T5.3 |
| **éªŒæ”¶æ ‡å‡†** | å¯æŸ¥çœ‹å…¨éƒ¨ç”¨æˆ·ã€åˆ†é…åˆ°ç»„ç»‡ã€æ›´æ”¹è§’è‰²ã€è®¾ä¸ºè¶…ç®¡ |
| **é¢„è®¡è€—æ—¶** | 1 å¤© |

#### T7.4 èœå•æ”¹é€ â€”â€”è¶…ç®¡å…¥å£ + ç»„ç»‡åˆ‡æ¢å™¨

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `frontend/src/components/menu.vue` |
| | æ–°å»º `frontend/src/components/OrganizationSwitcher.vue` |
| | `frontend/src/stores/menu.ts` |
| **å·¥ä½œå†…å®¹** | â‘  åˆ›å»º OrganizationSwitcher ç»„ä»¶ï¼št-select ä¸‹æ‹‰ï¼Œæ•°æ®æº `orgStore.myOrganizationList`ï¼Œç»‘å®š `orgStore.currentOrganizationId`ï¼Œåˆ‡æ¢æ—¶è°ƒç”¨ `switchOrganization()` |
| | â‘¡ menu.vue ä¸­æ’å…¥ OrganizationSwitcherï¼ˆLogo å’Œ TenantSelector ä¹‹åï¼‰ |
| | â‘¢ menu.vue ä¸­å¢åŠ è¶…ç®¡ä¸“å±èœå•é¡¹ï¼ˆç»„ç»‡ç®¡ç†ã€äººå‘˜ç®¡ç†ï¼‰ï¼Œç”¨ `v-if="authStore.isSuperAdmin"` æ§åˆ¶ |
| | â‘£ menu.ts ä¸­æ–°å¢å¯¹åº”èœå•å®šä¹‰ |
| **ä¾èµ–** | T5.1, T5.2 |
| **éªŒæ”¶æ ‡å‡†** | èœå•æ æ˜¾ç¤ºç»„ç»‡åˆ‡æ¢å™¨ï¼Œè¶…ç®¡é¢å¤–çœ‹åˆ°ç®¡ç†å…¥å£ï¼Œåˆ‡æ¢ç»„ç»‡åä¸‹æ‹‰å€¼æ›´æ–° |
| **é¢„è®¡è€—æ—¶** | 0.5 å¤© |

> **Sprint 7 æ£€æŸ¥ç‚¹**ï¼šè¶…ç®¡å®Œæ•´ç®¡ç†æµç¨‹å¯ç”¨â€”â€”é€šè¿‡èœå•è¿›å…¥ç®¡ç†é¡µé¢ â†’ åˆ›å»ºç»„ç»‡æ ‘ â†’ åˆ†é…äººå‘˜ã€‚

---

### Sprint 8ï¼šå‰ç«¯çŸ¥è¯†åº“å¯è§æ€§æ”¹é€ ï¼ˆ2.5 å¤©ï¼‰

#### T8.1 knowledge-base API æ‰©å±•

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `frontend/src/api/knowledge-base/index.ts` |
| **å·¥ä½œå†…å®¹** | â‘  `CreateKBRequest` æ¥å£æ–°å¢ `visibility`, `organization_id` å­—æ®µ |
| | â‘¡ `listKnowledgeBases` æ–¹æ³•æ–°å¢ `current_org_id` æŸ¥è¯¢å‚æ•° |
| | â‘¢ KB å“åº”ç±»å‹æ–°å¢ `created_by`, `visibility`, `organization_id`, `organization_name` å­—æ®µ |
| **ä¾èµ–** | T4.3ï¼ˆåç«¯ API å·²æ”¯æŒï¼‰ |
| **éªŒæ”¶æ ‡å‡†** | TypeScript ç±»å‹å®šä¹‰å®Œæ•´ï¼ŒAPI è°ƒç”¨å‚æ•°æ­£ç¡®ä¼ é€’ |
| **é¢„è®¡è€—æ—¶** | 2h |

#### T8.2 KnowledgeBaseList æ”¹é€ 

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `frontend/src/views/knowledge/KnowledgeBaseList.vue` |
| | `frontend/src/components/ListSpaceSidebar.vue` |
| **å·¥ä½œå†…å®¹** | â‘  KnowledgeBaseListï¼šè¯·æ±‚ KB åˆ—è¡¨æ—¶ä¼ å…¥ `current_org_id = orgStore.currentOrganizationId` |
| | â‘¡ KnowledgeBaseListï¼šç›‘å¬ `orgStore.currentOrganizationId` å˜åŒ–è‡ªåŠ¨åˆ·æ–°åˆ—è¡¨ |
| | â‘¢ ListSpaceSidebar æ”¹é€ ï¼ˆæˆ– KnowledgeBaseList å†…éƒ¨æ”¹é€ ï¼‰ï¼šå·¦ä¾§åˆ†ç»„æ”¹ä¸ºï¼šå…¨éƒ¨ / å…¨å±€çŸ¥è¯†åº“ / ç»„ç»‡çŸ¥è¯†åº“ / æˆ‘çš„çŸ¥è¯†åº“ |
| | â‘£ ç­›é€‰é€»è¾‘ï¼šæŒ‰ `visibility` å­—æ®µ + `created_by` å­—æ®µåšå‰ç«¯è¿‡æ»¤ï¼ˆæˆ–ä¼ å‚åç«¯ï¼‰ |
| | â‘¤ å¡ç‰‡ä¸Šå¢åŠ å¯è§æ€§æ ‡ç­¾ï¼ˆå…¨å±€/ç»„ç»‡/ç§æœ‰ï¼‰|
| **ä¾èµ–** | T8.1, T5.2 |
| **éªŒæ”¶æ ‡å‡†** | åˆ‡æ¢ç»„ç»‡å KB åˆ—è¡¨å®æ—¶åˆ·æ–°ï¼Œä¸‰ç§å¯è§æ€§åˆ†ç»„æ­£ç¡®æ˜¾ç¤º |
| **é¢„è®¡è€—æ—¶** | 1 å¤© |

#### T8.3 çŸ¥è¯†åº“åˆ›å»ºå¼¹çª—æ”¹é€ 

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `frontend/src/views/knowledge/KnowledgeBaseEditorModal.vue` |
| | æ–°å»º `frontend/src/components/OrgTreeSelector.vue` |
| **å·¥ä½œå†…å®¹** | â‘  OrgTreeSelectorï¼št-tree-select ç»„ä»¶ï¼Œæ•°æ®æº `orgTreeStore.tree` |
| | â‘¡ åˆ›å»ºå¼¹çª—æ–°å¢è¡¨å•é¡¹ï¼š"å¯è§æ€§" å•é€‰ç»„ï¼ˆprivate/org/globalï¼‰ |
| | â‘¢ visibility=org æ—¶æ˜¾ç¤º OrgTreeSelector é€‰æ‹©å½’å±ç»„ç»‡ï¼ˆé»˜è®¤å¡«å……å½“å‰ç»„ç»‡ï¼‰ |
| | â‘£ visibility=global ä»…è¶…ç®¡å¯é€‰ï¼ˆ`disabled: !authStore.isSuperAdmin`ï¼‰ |
| | â‘¤ è¡¨å•æäº¤æ—¶æºå¸¦ `visibility` + `organization_id` å‚æ•° |
| **ä¾èµ–** | T8.1, T5.3 |
| **éªŒæ”¶æ ‡å‡†** | å¯åˆ›å»ºä¸‰ç§å¯è§æ€§çš„ KBï¼Œéè¶…ç®¡ä¸èƒ½é€‰ globalï¼Œorg ç±»å‹å¿…é¡»é€‰æ‹©ç»„ç»‡ |
| **é¢„è®¡è€—æ—¶** | 0.5 å¤© |

#### T8.4 æ™ºèƒ½ä½“åˆ—è¡¨å…¼å®¹æ€§å¤„ç†

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `frontend/src/views/agent/AgentList.vue` |
| **å·¥ä½œå†…å®¹** | â‘  è¯„ä¼°æ™ºèƒ½ä½“åˆ—è¡¨æ˜¯å¦éœ€è¦åŒæ­¥çš„å¯è§æ€§æ”¹é€  |
| | â‘¡ è‹¥å½“å‰ä¸åš Agent å¯è§æ€§æ”¹é€ ï¼Œç¡®ä¿ç»„ç»‡åˆ‡æ¢ä¸å½±å“æ™ºèƒ½ä½“åˆ—è¡¨çš„æ­£å¸¸å±•ç¤º |
| | â‘¢ å¿…è¦æ—¶åœ¨ Agent åˆ—è¡¨è¯·æ±‚ä¸­ä¿æŒåŸæœ‰é€»è¾‘ï¼ˆä¸ä¼  current_org_idï¼‰ |
| **ä¾èµ–** | T5.2 |
| **éªŒæ”¶æ ‡å‡†** | ç»„ç»‡åˆ‡æ¢åï¼Œæ™ºèƒ½ä½“åˆ—è¡¨åŠŸèƒ½ä¸å—å½±å“ |
| **é¢„è®¡è€—æ—¶** | 2h |

---

### Sprint 9ï¼šæ”¶å°¾ï¼ˆ2 å¤©ï¼‰

#### T9.1 å›½é™…åŒ–

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–‡ä»¶** | `frontend/src/i18n/locales/zh-CN.ts`, `frontend/src/i18n/locales/en.ts` |
| **å·¥ä½œå†…å®¹** | æ–°å¢ç¿»è¯‘é”®ï¼ˆé¢„è®¡ 30-40 ä¸ªï¼‰ï¼š |
| | `admin.title`, `admin.orgTree`, `admin.members`, `admin.createOrg`, `admin.confirmDelete` |
| | `admin.assignOrg`, `admin.searchUser`, `admin.setSuperAdmin` |
| | `org.selectOrg`, `org.selectTargetOrg`, `org.switchSuccess` |
| | `kb.visibility`, `kb.visibilityGlobal`, `kb.visibilityOrg`, `kb.visibilityPrivate` |
| | `kb.selectOrg`, `kb.visibilityHint` |
| | `permission.superAdminRequired`, `permission.noAccess` |
| **ä¾èµ–** | T7.1-T8.3 |
| **éªŒæ”¶æ ‡å‡†** | ä¸­è‹±æ–‡åˆ‡æ¢æ—  key ç¼ºå¤±è­¦å‘Š |
| **é¢„è®¡è€—æ—¶** | 3h |

#### T9.2 å‰åç«¯è”è°ƒ

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **å·¥ä½œå†…å®¹** | â‘  è¶…ç®¡å®Œæ•´æµç¨‹ï¼šç™»å½• â†’ åˆ›å»ºç»„ç»‡æ ‘ â†’ åˆ†é…äººå‘˜ â†’ æ¨¡å‹é…ç½® â†’ åˆ›å»ºå…¨å±€ KB |
| | â‘¡ ç»„ç»‡ç®¡ç†å‘˜æµç¨‹ï¼šç™»å½• â†’ æŸ¥çœ‹æ‰€å±ç»„ç»‡ â†’ ç®¡ç†ç»„ç»‡æˆå‘˜ â†’ åˆ›å»ºç»„ç»‡ KB |
| | â‘¢ æ™®é€šç”¨æˆ·æµç¨‹ï¼šç™»å½• â†’ åˆ‡æ¢ç»„ç»‡ â†’ æŸ¥çœ‹å¯¹åº” KB â†’ åˆ›å»ºç§æœ‰ KB â†’ åˆ‡æ¢ç»„ç»‡éªŒè¯ KB åˆ—è¡¨å˜åŒ– |
| | â‘£ è¾¹ç•Œæƒ…å†µï¼šç”¨æˆ·æ— ç»„ç»‡æ—¶çš„ç©ºçŠ¶æ€ / åˆ é™¤ç»„ç»‡å KB å¯è§æ€§ / ç§»åŠ¨ç»„ç»‡åå­æ ‘ KB å¯è§æ€§ |
| | â‘¤ ä¿®å¤è”è°ƒä¸­å‘ç°çš„é—®é¢˜ |
| **ä¾èµ–** | å…¨éƒ¨å‰ç«¯ Sprint |
| **éªŒæ”¶æ ‡å‡†** | ä¸‰ç§è§’è‰²å…¨æµç¨‹æ— æŠ¥é”™ï¼Œæ•°æ®ä¸€è‡´ |
| **é¢„è®¡è€—æ—¶** | 1 å¤© |

#### T9.3 å›å½’æµ‹è¯• + å…¼å®¹æ€§éªŒè¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **å·¥ä½œå†…å®¹** | â‘  åŸæœ‰å…±äº«ç©ºé—´åŠŸèƒ½æ­£å¸¸ï¼šåˆ›å»ºç»„ç»‡ã€é‚€è¯·ç åŠ å…¥ã€KB/Agent å…±äº« |
| | â‘¡ ç°æœ‰çŸ¥è¯†åº“ï¼ˆæ—  visibility å­—æ®µçš„æ—§æ•°æ®ï¼Œé»˜è®¤ visibility='org', organization_id=''ï¼‰æ­£å¸¸æ˜¾ç¤º |
| | â‘¢ æ¨¡å‹åˆ—è¡¨ GET /models æ™®é€šç”¨æˆ·å¯æ­£å¸¸è¯»å–ï¼ˆä¸å—è¶…ç®¡ä¸­é—´ä»¶å½±å“ï¼‰ |
| | â‘£ é…ç½®è¯»å– GET /tenants/kv/:key æ™®é€šç”¨æˆ·å¯æ­£å¸¸è¯»å– |
| | â‘¤ Agent ç›¸å…³åŠŸèƒ½ä¸å—å½±å“ |
| | â‘¥ è·¨ç§Ÿæˆ·åˆ‡æ¢ï¼ˆcan_access_all_tenants ç”¨æˆ·ï¼‰åŠŸèƒ½æ­£å¸¸ |
| **ä¾èµ–** | T9.2 |
| **éªŒæ”¶æ ‡å‡†** | å›å½’æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼Œæ— åŠŸèƒ½é™çº§ |
| **é¢„è®¡è€—æ—¶** | 1 å¤© |

---

### æ—¶é—´çº¿æ±‡æ€»

```
Day 1  â”€â”€â”€â”€ Sprint 1: T1.1 è¿ç§»è„šæœ¬ + T1.2 Goç±»å‹ + T1.3 æ¥å£å®šä¹‰
Day 2  â”€â”€â”€â”€ Sprint 1 æ”¶å°¾ + Sprint 2: T2.1 è¶…ç®¡ä¸­é—´ä»¶ + T2.2 è·¯ç”±æ‹†åˆ†
Day 3  â”€â”€â”€â”€ Sprint 2: T2.3 Authæ”¹é€  + Sprint 3: T3.1 Org Repository
Day 4  â”€â”€â”€â”€ Sprint 3: T3.2 OrgTreeService
Day 5  â”€â”€â”€â”€ Sprint 3: T3.2 æ”¶å°¾ + T3.3 OrgTreeHandler
Day 6  â”€â”€â”€â”€ Sprint 3: T3.4 è·¯ç”±+DI + Sprint 4: T4.1 KB Repository
Day 7  â”€â”€â”€â”€ Sprint 4: T4.2 KBVisibilityService + T4.3 KB Handler æ”¹é€ 
Day 8  â”€â”€â”€â”€ Sprint 4: T4.4 DIæ³¨å†Œ â†’ åç«¯å®Œæˆ âœ… + Sprint 5: T5.1-T5.3 å‰ç«¯åŸºç¡€
Day 9  â”€â”€â”€â”€ Sprint 6: T6.1-T6.3 æƒé™æ§åˆ¶
Day 10 â”€â”€â”€â”€ Sprint 7: T7.1 AdminLayout + T7.4 èœå•æ”¹é€ 
Day 11 â”€â”€â”€â”€ Sprint 7: T7.2 OrgTreeManage
Day 12 â”€â”€â”€â”€ Sprint 7: T7.3 MemberManage
Day 13 â”€â”€â”€â”€ Sprint 8: T8.1 KB API + T8.2 KBList æ”¹é€ 
Day 14 â”€â”€â”€â”€ Sprint 8: T8.3 KBåˆ›å»º + T8.4 Agentå…¼å®¹ + Sprint 9: T9.1 å›½é™…åŒ–
Day 15 â”€â”€â”€â”€ Sprint 9: T9.2 è”è°ƒ + T9.3 å›å½’æµ‹è¯•
```

| Sprint | å¤©æ•° | ä»»åŠ¡æ•° | é‡Œç¨‹ç¢‘ |
|--------|------|--------|--------|
| Sprint 1: æ•°æ®åº“+ç±»å‹ | 1.5 | 3 | æ•°æ®åº“å’Œç±»å‹å°±ç»ª |
| Sprint 2: è¶…ç®¡ä¸­é—´ä»¶ | 1.5 | 3 | è¶…ç®¡ API å—ä¿æŠ¤ |
| Sprint 3: ç»„ç»‡æ ‘åç«¯ | 3 | 4 | ç»„ç»‡æ ‘ API å®Œæ•´å¯ç”¨ |
| Sprint 4: KBå¯è§æ€§åç«¯ | 2 | 4 | **åç«¯å…¨éƒ¨å®Œæˆ** |
| Sprint 5: å‰ç«¯åŸºç¡€ | 1 | 3 | Store å’Œ API å°±ç»ª |
| Sprint 6: å‰ç«¯æƒé™ | 1.5 | 3 | Settings + è·¯ç”±å—ä¿æŠ¤ |
| Sprint 7: è¶…ç®¡é¡µé¢ | 3 | 4 | è¶…ç®¡ç®¡ç†é¡µé¢å®Œæˆ |
| Sprint 8: KBæ”¹é€ å‰ç«¯ | 2.5 | 4 | **å‰ç«¯å…¨éƒ¨å®Œæˆ** |
| Sprint 9: æ”¶å°¾ | 2 | 3 | è”è°ƒ+å›å½’é€šè¿‡ |
| **æ€»è®¡** | **~15** | **31** | |

**æ€»è®¡ 31 ä¸ªä»»åŠ¡ï¼Œé¢„è®¡ 15 ä¸ªå·¥ä½œæ—¥ã€‚**

---

## 10. æ€»ç»“

| è®¾è®¡å†³ç­– | é€‰æ‹© | ç†ç”± |
|----------|------|------|
| RBAC | **ä¸å¼•å…¥** | ã€Œè¶…ç®¡ + ç»„ç»‡è§’è‰²ã€å·²æ»¡è¶³éœ€æ±‚ï¼Œé¿å…è¿‡åº¦è®¾è®¡ |
| è¶…ç®¡é¡µé¢ | **Settings æŒ‰è§’è‰²è¿‡æ»¤ + ç‹¬ç«‹ admin è·¯ç”±** | æœ€å°æ”¹åŠ¨ï¼Œä¸ç ´åç°æœ‰æ¨¡æ€æ¡†ç»“æ„ |
| å¤šç»„ç»‡å½’å± | **organization_members å¤šå¯¹å¤š + currentOrganizationId** | å¤ç”¨ç°æœ‰è¡¨ç»“æ„ï¼Œå‰ç«¯ç»´æŠ¤å½“å‰ç»„ç»‡ |
| çŸ¥è¯†åº“å¯è§èŒƒå›´ | **åŸºäº currentOrgId å®æ—¶è¿‡æ»¤** | ç”¨æˆ·åˆ‡æ¢ç»„ç»‡åç«‹å³åˆ·æ–°åˆ—è¡¨ |
| ç»„ç»‡æ ‘ + å…±äº«ç©ºé—´ | **å…±å­˜ï¼Œç”¨ tenant_id åŒºåˆ†** | ä¿æŒå‘ä¸‹å…¼å®¹ |
| å‰ç«¯æ–°å¢ | **11 æ–°æ–‡ä»¶ + 13 ä¿®æ”¹** | æŒ‰ API/Store/ç»„ä»¶/é¡µé¢/è·¯ç”± åˆ†å±‚ç»„ç»‡ |
